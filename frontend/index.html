<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0" />
    <title>VisionFlow AI - Your AI Business Toolkit</title>
    <meta name="description" content="The luxury all-in-one AI business, branding, and product toolkit. Build, launch, and scale your next big idea with confidence." />
    <meta name="theme-color" content="#18122B" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <style>
        :root {
            --primary-color: #FFD700;
            --primary-dark: #bfa14a;
            --secondary-color: #18122B;
            --secondary-light: #22223B;
            --tertiary-color: #23213a;
            --accent-color: #fffbe6;
            --text-primary: #f5f3e7;
            --text-secondary: #bfa14a;
            --text-muted: rgba(191, 161, 74, 0.7);
            --success-color: #22c55e;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --gradient-primary: linear-gradient(135deg, #18122B 0%, #22223B 100%);
            --gradient-secondary: linear-gradient(90deg, #FFD700 0%, #bfa14a 100%);
            --gradient-glass: rgba(24, 18, 43, 0.85);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-glow: 0 4px 24px rgba(255, 215, 0, 0.25);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            --spacing-3xl: 4rem;
            --transition-fast: 150ms ease;
            --transition-base: 200ms ease;
            --transition-slow: 300ms ease;
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal: 1040;
            --z-popover: 1050;
            --z-tooltip: 1060;
            --z-toast: 1070;
        }

        body.light-mode {
            --primary-color: #bfa14a;
            --primary-dark: #FFD700;
            --secondary-color: #fffbe6;
            --secondary-light: #f7f7fa;
            --tertiary-color: #ffffff;
            --accent-color: #23213a;
            --text-primary: #23213a;
            --text-secondary: #bfa14a;
            --text-muted: rgba(35, 33, 58, 0.7);
            --gradient-primary: linear-gradient(135deg, #fffbe6 0%, #f7f7fa 100%);
            --gradient-glass: rgba(255, 255, 255, 0.9);
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--gradient-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            opacity: 0;
            animation: pageLoadFadeIn 0.8s ease-out forwards;
        }

        @keyframes pageLoadFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--spacing-lg);
            background: var(--gradient-glass);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(10px);
            min-height: 100vh;
            animation: containerSlideUp 0.6s ease-out 0.2s both;
        }

        @keyframes containerSlideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Header */
        .header {
            padding: var(--spacing-xl) 0;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            margin-bottom: var(--spacing-xl);
            animation: headerFadeIn 0.8s ease-out 0.4s both;
        }

        @keyframes headerFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .vision-logo {
            width: 80px;
            height: 80px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-glow);
            border: 2px solid rgba(255, 215, 0, 0.3);
            background: var(--accent-color);
            padding: var(--spacing-sm);
            object-fit: contain;
            transition: all var(--transition-base);
            animation: logoFloat 3s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-5px) scale(1.02); }
        }

        .vision-logo:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: var(--shadow-glow), 0 0 30px rgba(255, 215, 0, 0.4);
        }

        .brand-info {
            flex: 1;
        }

        .brand-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2rem, 4vw, 2.5rem);
            color: var(--primary-color);
            margin: 0;
            text-shadow: 0 2px 16px rgba(0, 0, 0, 0.5);
            animation: textGlow 2s ease-in-out infinite alternate;
        }

        @keyframes textGlow {
            from {
                text-shadow: 0 2px 16px rgba(0, 0, 0, 0.5);
            }
            to {
                text-shadow: 0 2px 16px rgba(255, 215, 0, 0.3);
            }
        }

        .brand-subtitle {
            font-size: clamp(1rem, 2.5vw, 1.25rem);
            color: var(--text-secondary);
            margin: 0;
            font-weight: 500;
            animation: subtitleSlide 0.8s ease-out 0.6s both;
        }

        @keyframes subtitleSlide {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .header-actions {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
            animation: actionsSlide 0.8s ease-out 0.8s both;
        }

        @keyframes actionsSlide {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            background: var(--gradient-secondary);
            color: var(--secondary-color);
            border: none;
            border-radius: var(--radius-xl);
            padding: var(--spacing-md) var(--spacing-lg);
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            cursor: pointer;
            transition: all var(--transition-base);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .theme-toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .theme-toggle:hover::before {
            left: 100%;
        }

        .theme-toggle:hover, .theme-toggle:focus {
            background: linear-gradient(90deg, var(--primary-dark) 0%, var(--primary-color) 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .theme-icon {
            font-size: 1.125rem;
            transition: transform var(--transition-base);
        }

        .theme-toggle:hover .theme-icon {
            transform: rotate(180deg) scale(1.2);
        }

        /* Auth Section */
        .auth-section {
            background: var(--gradient-glass);
            border-radius: var(--radius-2xl);
            padding: var(--spacing-2xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 215, 0, 0.2);
            text-align: center;
            margin-bottom: var(--spacing-2xl);
            animation: authSlideIn 0.8s ease-out 1s both;
            transition: all var(--transition-base);
        }

        @keyframes authSlideIn {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .auth-section:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-2px);
        }

        .auth-title {
            color: var(--primary-color);
            margin-bottom: var(--spacing-md);
            font-size: clamp(1.875rem, 4vw, 2.25rem);
            font-family: 'Playfair Display', serif;
            animation: titlePulse 0.8s ease-out 1.2s both;
        }

        @keyframes titlePulse {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .auth-description {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xl);
            font-size: clamp(1rem, 2.5vw, 1.125rem);
            animation: descriptionSlide 0.8s ease-out 1.4s both;
        }

        @keyframes descriptionSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
            max-width: 400px;
            margin: 0 auto;
        }

        .form-group {
            text-align: left;
            animation: formGroupSlide 0.6s ease-out var(--delay, 1.6s) both;
        }

        .form-group:nth-child(1) { --delay: 1.6s; }
        .form-group:nth-child(2) { --delay: 1.8s; }

        @keyframes formGroupSlide {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .form-label {
            display: block;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            font-size: 0.875rem;
            transition: all var(--transition-base);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: var(--spacing-md);
            border: 1.5px solid rgba(255, 215, 0, 0.2);
            border-radius: var(--radius-lg);
            background: var(--tertiary-color);
            color: var(--primary-color);
            font-family: 'Montserrat', sans-serif;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            transition: all var(--transition-base);
            position: relative;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
            transform: translateY(-2px) scale(1.02);
        }

        .form-input::placeholder {
            color: var(--text-muted);
            transition: all var(--transition-base);
        }

        .form-input:focus::placeholder {
            opacity: 0.7;
            transform: translateY(-2px);
        }

        /* Password Input Container */
        .password-input-container {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: var(--spacing-md);
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: all var(--transition-fast);
            font-size: 1.125rem;
            z-index: 2;
        }

        .password-toggle:hover {
            color: var(--primary-color);
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-50%) scale(1.1);
        }

        .password-toggle:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        .password-input-with-toggle {
            padding-right: 3rem !important;
        }

        .error-message {
            color: var(--error-color);
            font-size: 0.875rem;
            margin-top: var(--spacing-xs);
            min-height: 1.2em;
            transition: all var(--transition-base);
            transform: translateY(-5px);
            opacity: 0;
        }

        .error-message:not(:empty) {
            transform: translateY(0);
            opacity: 1;
            animation: errorShake 0.5s ease-out;
        }

        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .auth-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
            animation: buttonsSlide 0.8s ease-out 2s both;
        }

        @keyframes buttonsSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-md) var(--spacing-lg);
            border: none;
            border-radius: var(--radius-lg);
            font-family: 'Montserrat', sans-serif;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-secondary);
            color: var(--secondary-color);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover, .btn-primary:focus {
            background: linear-gradient(90deg, var(--primary-dark) 0%, var(--primary-color) 100%);
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--tertiary-color);
            color: var(--primary-color);
            border: 1.5px solid rgba(255, 215, 0, 0.3);
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary:hover, .btn-secondary:focus {
            background: var(--gradient-secondary);
            color: var(--secondary-color);
            border-color: var(--primary-color);
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow-lg);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-loader {
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .logout-btn {
            background: var(--tertiary-color);
            color: var(--primary-color);
            border: 1.5px solid rgba(255, 215, 0, 0.3);
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--radius-lg);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            font-family: 'Montserrat', sans-serif;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
        }

        .logout-btn:hover, .logout-btn:focus {
            background: var(--gradient-secondary);
            color: var(--secondary-color);
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        /* Main Section */
        .main-section {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xl);
            animation: mainSlideIn 0.8s ease-out 0.5s both;
        }

        @keyframes mainSlideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tool-selector {
            background: var(--gradient-glass);
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 215, 0, 0.2);
            transition: all var(--transition-base);
        }

        .tool-selector:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .tool-label {
            display: block;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            font-size: clamp(1rem, 2.5vw, 1.125rem);
            animation: labelGlow 2s ease-in-out infinite alternate;
        }

        @keyframes labelGlow {
            from { opacity: 0.8; }
            to { opacity: 1; }
        }

        .tool-select {
            width: 100%;
            padding: var(--spacing-md);
            border: 1.5px solid rgba(255, 215, 0, 0.2);
            border-radius: var(--radius-lg);
            background: var(--tertiary-color);
            color: var(--primary-color);
            font-family: 'Montserrat', sans-serif;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .tool-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
            transform: scale(1.02);
        }

        .prompt-suggestion {
            background: rgba(255, 215, 0, 0.1);
            border: none;
            border-left: 3px solid var(--primary-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            color: var(--primary-color);
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            margin-bottom: var(--spacing-lg);
            animation: suggestionPulse 1s ease-out;
            transition: all var(--transition-base);
        }

        @keyframes suggestionPulse {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .prompt-suggestion:hover {
            background: rgba(255, 215, 0, 0.15);
            transform: translateX(5px);
        }

        /* Chat */
        .chat-container {
            background: var(--gradient-glass);
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 215, 0, 0.2);
            transition: all var(--transition-base);
        }

        .chat-container:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .chat-box {
            background: var(--tertiary-color);
            border: 1.5px solid rgba(255, 215, 0, 0.3);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            height: clamp(300px, 40vh, 500px);
            overflow-y: auto;
            margin-bottom: var(--spacing-lg);
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) transparent;
            transition: all var(--transition-base);
        }

        .chat-box::-webkit-scrollbar {
            width: 6px;
        }

        .chat-box::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-box::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
            transition: background var(--transition-base);
        }

        .chat-box::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        .chat-welcome {
            text-align: center;
            color: var(--text-secondary);
            padding: var(--spacing-xl);
            animation: welcomeFloat 0.8s ease-out;
        }

        @keyframes welcomeFloat {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-welcome h3 {
            color: var(--primary-color);
            margin-bottom: var(--spacing-md);
            animation: welcomeTitleGlow 2s ease-in-out infinite alternate;
        }

        @keyframes welcomeTitleGlow {
            from { opacity: 0.8; }
            to { opacity: 1; }
        }

        .chat-form {
            display: flex;
            gap: var(--spacing-md);
            align-items: stretch;
        }

        .chat-input {
            flex: 1;
            padding: var(--spacing-md);
            border: 1.5px solid rgba(255, 215, 0, 0.2);
            border-radius: var(--radius-lg);
            background: var(--tertiary-color);
            color: var(--primary-color);
            font-family: 'Montserrat', sans-serif;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            transition: all var(--transition-base);
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
            transform: translateY(-2px);
        }

        .chat-send-btn {
            background: var(--gradient-secondary);
            color: var(--secondary-color);
            border: none;
            border-radius: var(--radius-lg);
            padding: 0 var(--spacing-lg);
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 60px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .chat-send-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transition: all 0.6s;
            transform: translate(-50%, -50%);
        }

        .chat-send-btn:hover::before {
            width: 100%;
            height: 100%;
        }

        .chat-send-btn:hover, .chat-send-btn:focus {
            background: linear-gradient(90deg, var(--primary-dark) 0%, var(--primary-color) 100%);
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--shadow-lg);
        }

        .send-icon {
            font-size: 1.25rem;
            font-weight: bold;
            z-index: 1;
            transition: transform var(--transition-base);
        }

        .chat-send-btn:hover .send-icon {
            transform: translateX(2px);
        }

        .input-counter {
            text-align: right;
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-top: var(--spacing-xs);
            transition: all var(--transition-base);
        }

        /* Action Grid */
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--spacing-md);
            margin-top: var(--spacing-xl);
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            background: var(--gradient-glass);
            color: var(--primary-color);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            cursor: pointer;
            transition: all var(--transition-base);
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            position: relative;
            font-size: clamp(0.875rem, 2vw, 1rem);
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.2), transparent);
            transition: left 0.5s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover, .action-btn:focus {
            background: var(--gradient-secondary);
            color: var(--secondary-color);
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow-lg);
        }

        .action-icon {
            font-size: 1.125rem;
            transition: transform var(--transition-base);
        }

        .action-btn:hover .action-icon {
            transform: scale(1.2) rotate(5deg);
        }

        .action-text {
            font-size: 0.875rem;
        }

        /* Favorites */
        .favorites-list {
            background: var(--gradient-glass);
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            margin-top: var(--spacing-xl);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(255, 215, 0, 0.2);
            max-height: 400px;
            overflow-y: auto;
            animation: favoritesSlideIn 0.6s ease-out;
        }

        @keyframes favoritesSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .favorites-list li {
            list-style: none;
            background: var(--tertiary-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            border: 1px solid rgba(255, 215, 0, 0.1);
            word-wrap: break-word;
            animation: favoriteItemSlide 0.4s ease-out;
            transition: all var(--transition-base);
        }

        @keyframes favoriteItemSlide {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .favorites-list li:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow-md);
        }

        .favorites-list li:last-child {
            margin-bottom: 0;
        }

        .favorites-list button {
            margin-top: var(--spacing-md);
            margin-right: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.875rem;
            border-radius: var(--radius-md);
            background: var(--gradient-secondary);
            color: var(--secondary-color);
            border: none;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .favorites-list button:hover {
            background: linear-gradient(90deg, var(--primary-dark) 0%, var(--primary-color) 100%);
            transform: translateY(-2px);
        }

        /* Footer */
        .site-footer {
            background: var(--gradient-glass);
            border-top: 1px solid rgba(255, 215, 0, 0.2);
            padding: var(--spacing-2xl) var(--spacing-lg);
            margin-top: var(--spacing-3xl);
            border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
            animation: footerSlideUp 0.8s ease-out 0.8s both;
        }

        @keyframes footerSlideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .footer-inner {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .footer-brand {
            font-weight: 600;
            font-size: clamp(1rem, 2.5vw, 1.125rem);
            color: var(--primary-color);
            margin-bottom: var(--spacing-lg);
            animation: brandPulse 2s ease-in-out infinite alternate;
        }

        @keyframes brandPulse {
            from { opacity: 0.8; }
            to { opacity: 1; }
        }

        .footer-highlight {
            color: var(--primary-color);
        }

        .footer-nav {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .footer-link {
            color: var(--primary-color);
            text-decoration: none;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            transition: all var(--transition-base);
            font-weight: 500;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            position: relative;
        }

        .footer-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: var(--primary-color);
            transition: all var(--transition-base);
            transform: translateX(-50%);
        }

        .footer-link:hover::after {
            width: 80%;
        }

        .footer-link:hover, .footer-link:focus {
            background: rgba(255, 215, 0, 0.2);
            color: var(--accent-color);
            transform: translateY(-2px);
        }

        .footer-tagline {
            font-size: clamp(0.875rem, 2vw, 1rem);
            color: var(--text-secondary);
            font-style: italic;
            animation: taglineGlow 3s ease-in-out infinite alternate;
        }

        @keyframes taglineGlow {
            from { opacity: 0.7; }
            to { opacity: 1; }
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            backdrop-filter: blur(4px);
            animation: overlayFadeIn 0.3s ease-out;
        }

        @keyframes overlayFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 215, 0, 0.3);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: var(--spacing-lg);
        }

        .loading-text {
            color: var(--primary-color);
            font-size: clamp(1rem, 2.5vw, 1.125rem);
            font-weight: 600;
            animation: loadingPulse 1.5s ease-in-out infinite;
        }

        @keyframes loadingPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: var(--spacing-lg);
            right: var(--spacing-lg);
            z-index: var(--z-toast);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .toast {
            background: var(--gradient-glass);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(10px);
            max-width: 350px;
            animation: toastSlideIn 0.3s ease-out;
            transition: all var(--transition-base);
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        .toast:hover {
            transform: translateY(-2px);
        }

        .toast.toast-success {
            border-color: var(--success-color);
            background: rgba(34, 197, 94, 0.1);
        }

        .toast.toast-error {
            border-color: var(--error-color);
            background: rgba(239, 68, 68, 0.1);
        }

        .toast-content {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
        }

        .toast-icon {
            font-size: 1.125rem;
            animation: iconBounce 0.6s ease-out;
        }

        @keyframes iconBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .toast-message {
            flex: 1;
            color: var(--text-primary);
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.125rem;
            padding: 0;
            margin-left: var(--spacing-sm);
            transition: all var(--transition-base);
        }

        .toast-close:hover {
            color: var(--primary-color);
            transform: rotate(90deg);
        }

        /* Chat Message Styles */
        .chat-box p {
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-sm) 0;
            animation: messageSlideIn 0.4s ease-out;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-box strong {
            color: var(--primary-color);
            font-weight: 600;
        }

        .chat-box pre {
            background: rgba(34, 34, 59, 0.92);
            color: var(--primary-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-md) var(--spacing-lg);
            margin: var(--spacing-md) 0;
            font-size: clamp(0.875rem, 2vw, 1rem);
            font-family: 'Montserrat', 'Consolas', monospace;
            box-shadow: var(--shadow-sm);
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid rgba(255, 215, 0, 0.1);
            animation: codeBlockSlide 0.5s ease-out;
        }

        @keyframes codeBlockSlide {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .chat-box img {
            max-width: 100%;
            height: auto;
            border-radius: var(--radius-md);
            margin: var(--spacing-md) 0;
            box-shadow: var(--shadow-md);
            animation: imageZoomIn 0.6s ease-out;
            transition: transform var(--transition-base);
        }

        @keyframes imageZoomIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .chat-box img:hover {
            transform: scale(1.02);
        }

        /* Utility Classes */
        .hidden { 
            display: none !important; 
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Floating particles background effect */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.3;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--primary-color);
            border-radius: 50%;
            animation: float 6s infinite linear;
        }

        @keyframes float {
            0% {
                opacity: 0;
                transform: translateY(100vh) rotate(0deg);
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) rotate(360deg);
            }
        }

        .particle:nth-child(1) { left: 20%; animation-delay: -0.5s; animation-duration: 7s; }
        .particle:nth-child(2) { left: 40%; animation-delay: -1s; animation-duration: 8s; }
        .particle:nth-child(3) { left: 60%; animation-delay: -2s; animation-duration: 9s; }
        .particle:nth-child(4) { left: 80%; animation-delay: -3s; animation-duration: 6s; }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: var(--spacing-md);
                border-radius: var(--radius-xl);
            }
            
            .logo-header {
                flex-direction: column;
                text-align: center;
                gap: var(--spacing-md);
            }
            
            .brand-title {
                font-size: clamp(1.75rem, 4vw, 2.25rem);
            }
            
            .brand-subtitle {
                font-size: clamp(0.875rem, 2.5vw, 1.125rem);
            }
            
            .vision-logo {
                width: 60px;
                height: 60px;
            }
            
            .header-actions {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .theme-toggle {
                padding: var(--spacing-sm) var(--spacing-md);
            }
            
            .theme-text {
                display: none;
            }
            
            .auth-buttons {
                grid-template-columns: 1fr;
            }
            
            .chat-box {
                height: clamp(250px, 35vh, 350px);
            }
            
            .chat-form {
                flex-direction: column;
                gap: var(--spacing-sm);
            }
            
            .action-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-nav {
                flex-direction: column;
                gap: var(--spacing-sm);
            }
            
            .toast-container {
                top: var(--spacing-sm);
                right: var(--spacing-sm);
                left: var(--spacing-sm);
            }
            
            .toast {
                max-width: none;
            }

            .form-input, .form-select, .form-textarea, .chat-input {
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: var(--spacing-sm);
            }
            
            .auth-section, .tool-selector, .chat-container {
                padding: var(--spacing-lg);
            }
            
            .chat-box {
                height: clamp(200px, 30vh, 300px);
                padding: var(--spacing-md);
            }
            
            .action-btn {
                padding: var(--spacing-sm);
                font-size: 0.875rem;
            }
        }

        /* High contrast mode */
        @media (prefers-contrast: high) {
            .form-input, .form-select, .form-textarea {
                border-width: 2px;
            }
            
            .btn {
                border: 2px solid var(--primary-color);
            }
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }

            body {
                opacity: 1;
                animation: none;
            }
        }

        /* Focus indicators */
        *:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        button:focus, input:focus, select:focus, textarea:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Floating Particles Background -->
    <div class="particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo-header">
                <img src="vision logo.jpeg" alt="VisionFlow Logo" class="vision-logo" loading="lazy" />
                <div class="brand-info">
                    <h1 class="brand-title">VisionFlow AI</h1>
                    <p class="brand-subtitle">Your all-in-one AI business, branding, and product toolkit</p>
                </div>
            </div>
            
            <div class="header-actions">
                <button id="toggle-theme" class="theme-toggle" aria-label="Toggle dark/light mode">
                    <span class="theme-icon">🌙</span>
                    <span class="theme-text">Toggle Dark Mode</span>
                </button>
                <button id="logout-button" class="logout-btn hidden" aria-label="Logout">
                    <span>Logout</span>
                </button>
            </div>
        </header>

        <!-- Auth Section -->
        <section id="auth-section" class="auth-section">
            <div class="auth-card">
                <h2 class="auth-title">Welcome to VisionFlow</h2>
                <p class="auth-description">Sign in to access your AI business toolkit</p>
                
                <form id="auth-form" class="auth-form" novalidate>
                    <div class="form-group">
                        <label for="email" class="form-label">Email Address</label>
                        <input 
                            type="email" 
                            id="email" 
                            class="form-input" 
                            placeholder="Enter your email" 
                            required 
                            aria-describedby="email-error"
                            autocomplete="email"
                        />
                        <div id="email-error" class="error-message" role="alert"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="password" class="form-label">Password</label>
                        <div class="password-input-container">
                            <input 
                                type="password" 
                                id="password" 
                                class="form-input password-input-with-toggle" 
                                placeholder="Enter your password" 
                                required 
                                aria-describedby="password-error"
                                autocomplete="current-password"
                            />
                            <button 
                                type="button" 
                                id="password-toggle" 
                                class="password-toggle"
                                aria-label="Toggle password visibility"
                                title="Show/Hide password"
                            >
                                👁️
                            </button>
                        </div>
                        <div id="password-error" class="error-message" role="alert"></div>
                    </div>
                    
                    <div class="auth-buttons">
                        <button id="signup-btn" type="button" class="btn btn-secondary" data-loading="Signing Up...">
                            <span class="btn-text">Sign Up</span>
                            <span class="btn-loader hidden" aria-hidden="true"></span>
                        </button>
                        <button id="login-btn" type="button" class="btn btn-primary" data-loading="Logging In...">
                            <span class="btn-text">Login</span>
                            <span class="btn-loader hidden" aria-hidden="true"></span>
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Main App Section -->
        <main id="main-section" class="main-section hidden">
            <div class="tool-selector">
                <label for="tool-select" class="tool-label">Choose Your AI Tool:</label>
                <select id="tool-select" class="tool-select" aria-label="Select AI tool">
                    <option value="cofounder">AI Cofounder Chat</option>
                    <option value="motivator">Motivator Friend</option>
                    <option value="idea">Idea Engine</option>
                    <option value="ideatester">Idea Tester</option>
                    <option value="market">Market Research</option>
                    <option value="mvp">MVP Planner</option>
                    <option value="gtm">Go-to-Market Kit</option>
                    <option value="brand">Brand Builder</option>
                    <option value="step">Step-by-Step Guidance</option>
                    <option value="pitch">Pitch Deck Generator</option>
                    <option value="plan">Business Plan Writer</option>
                    <option value="adcopy">Ad Copy Generator</option>
                    <option value="logo">AI Logo Generator</option>
                    <option value="resume">Resume Generator</option>
                    <option value="winning">Find Winning Product</option>
                    <option value="legal">AI Legal/Terms Generator</option>
                    <option value="name">AI Product Name Generator</option>
                    <option value="email">AI Email & Outreach Generator</option>
                    <option value="landing">Landing Page Copy Generator</option>
                    <option value="digitalproduct">Digital Product Finder</option>
                    <option value="valueprop">AI Value Proposition Generator</option>
                    <option value="validate">Problem/Solution Validator</option>
                    <option value="growth">Growth Hacking Ideas</option>
                    <option value="funding">Funding & Investor Outreach</option>
                    <option value="community">Community Building Ideas</option>
                    <option value="scale">Scale Planner</option>
                    <option value="social">Social Marketing Strategist</option>
                </select>
            </div>

            <div id="prompt-suggestion" class="prompt-suggestion" aria-live="polite"></div>

            <div class="chat-container">
                <div id="chat-box" class="chat-box" role="log" aria-live="polite" aria-label="Chat conversation">
                    <div class="chat-welcome">
                        <h3>Welcome to VisionFlow AI! 🚀</h3>
                        <p>Select a tool above and start building your business idea.</p>
                    </div>
                </div>

                <form id="chat-form" class="chat-form">
                    <input 
                        type="text" 
                        id="user-input" 
                        class="chat-input" 
                        placeholder="Ask VisionFlow anything..." 
                        required 
                        aria-label="Enter your message"
                        maxlength="500"
                    />
                    <button id="send-btn" type="submit" class="chat-send-btn" aria-label="Send message">
                        <span class="send-icon">→</span>
                    </button>
                </form>
                
                <div class="input-counter">
                    <span id="char-count">0</span>/500
                </div>
            </div>

            <div class="action-grid">
                <button id="view-favorites-btn" class="action-btn" data-tooltip="View your saved responses">
                    <span class="action-icon">📂</span>
                    <span class="action-text">View Favorites</span>
                </button>
                <button id="clear-favorites-btn" class="action-btn" data-tooltip="Clear all favorites">
                    <span class="action-icon">🗑</span>
                    <span class="action-text">Clear Favorites</span>
                </button>
                <button id="export-txt-btn" class="action-btn" data-tooltip="Export to text file">
                    <span class="action-icon">📄</span>
                    <span class="action-text">Export TXT</span>
                </button>
                <button id="export-csv-btn" class="action-btn" data-tooltip="Export to CSV">
                    <span class="action-icon">📊</span>
                    <span class="action-text">Export CSV</span>
                </button>
                <button id="export-pdf-btn" class="action-btn" data-tooltip="Export to PDF">
                    <span class="action-icon">🖨</span>
                    <span class="action-text">Export PDF</span>
                </button>
            </div>

            <div id="favorites-list" class="favorites-list hidden" role="list" aria-label="Favorites list">
                <!-- Favorites will be populated here -->
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-inner">
            <div class="footer-brand">© 2025 <span class="footer-highlight">VisionFlow</span> — All rights reserved.</div>
            <nav class="footer-nav" aria-label="Footer navigation">
                <a href="privacy-policy.html" class="footer-link">Privacy Policy</a>
                <a href="terms-of-service.html" class="footer-link">Terms of Service</a>
                <a href="cookie-policy.html" class="footer-link">Cookie Policy</a>
                <a href="plan.html" class="footer-link">Pricing</a>
                <a href="contact.html" class="footer-link">Contact</a>
            </nav>
            <div class="footer-tagline">Built by entrepreneurs, for entrepreneurs 🚀</div>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
        <p class="loading-text">Processing your request...</p>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container" aria-live="polite"></div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Global variables
        let loggedInUser = null;
        let favorites = [];

        // Tool prompts
        const toolPrompts = {
            cofounder: "Ask anything about launching your startup idea.",
            motivator: "I'm feeling overwhelmed with my startup journey and need some encouragement and motivation to keep going.",
            scale: "Create a 6-month scaling roadmap for a fashion e-commerce startup.",
            idea: "Give me 3 business ideas for online tutoring.",
            ideatester: "Test my idea: An app that delivers groceries by drone in rural areas.",
            market: "Do market research for fitness tech startup.",
            mvp: "Create an MVP launch plan for a note-taking app.",
            gtm: "Write a go-to-market plan for my productivity tool.",
            brand: "Suggest branding for an AI fashion startup.",
            step: "Step-by-step launch for a dropshipping brand.",
            pitch: "Make a 10-slide pitch deck for a crypto wallet.",
            plan: "Write a full business plan for a pet supply store.",
            adcopy: "Create ad copy for my AI content generator.",
            logo: "Generate the best, clean, downloadable logo for a dropshipping brand called Fixora.",
            resume: "Write a resume for a software engineer with 2 years experience.",
            winning: "Find 5 winning products for a TikTok-friendly gadget store.",
            legal: "Generate a Privacy Policy and Terms for my mobile fitness app.",
            name: "Suggest 5 product names for a smart wearable ring.",
            email: "Write a cold outreach email to potential investors for my travel startup.",
            landing: "Generate a landing page copy for a smart home automation platform.",
            digitalproduct: "Find 5 digital product ideas for students and educators.",
            valueprop: "Generate a value proposition for my AI hiring platform.",
            validate: "Validate the problem and solution for my app that matches local tutors with students.",
            growth: "Suggest 3 growth hacking strategies for my e-commerce store.",
            funding: "Write an email to angel investors for my fintech startup.",
            community: "Give me ideas to build a community around my online course platform.",
            social: "Create a 30-day Instagram strategy for a fitness brand.",
        };

        // Utility functions
        function showToast(message, type = 'success', duration = 5000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-content">
                    <span class="toast-icon">${type === 'success' ? '✅' : '❌'}</span>
                    <span class="toast-message">${message}</span>
                    <button class="toast-close" onclick="this.parentNode.parentNode.remove()" aria-label="Close notification">×</button>
                </div>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, duration);
        }

        function showLoading(show = true) {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.classList.toggle('hidden', !show);
            }
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function isValidPassword(password) {
            return password.length >= 8;
        }

        function restoreSession() {
            const savedUser = localStorage.getItem("visionflowUser");
            const authSection = document.getElementById("auth-section");
            const mainSection = document.getElementById("main-section");
            const logoutButton = document.getElementById("logout-button");
            
            if (savedUser) {
                try {
                    loggedInUser = JSON.parse(savedUser);
                    if (authSection) authSection.classList.add("hidden");
                    if (mainSection) mainSection.classList.remove("hidden");
                    if (logoutButton) logoutButton.classList.remove("hidden");
                    setTimeout(() => loadChatHistory(), 100);
                } catch (e) {
                    console.error('Error parsing saved user:', e);
                    localStorage.removeItem("visionflowUser");
                }
            } else {
                loggedInUser = null;
                if (mainSection) mainSection.classList.add("hidden");
                if (authSection) authSection.classList.remove("hidden");
                if (logoutButton) logoutButton.classList.add("hidden");
            }
        }

        function updateThemeButton() {
            const btn = document.getElementById("toggle-theme");
            if (btn) {
                const isLight = document.body.classList.contains("light-mode");
                btn.innerHTML = `
                    <span class="theme-icon">${isLight ? "🌙" : "☀️"}</span>
                    <span class="theme-text">${isLight ? "Dark Mode" : "Light Mode"}</span>
                `;
            }
        }

        function updateToolUI() {
            const toolSelect = document.getElementById("tool-select");
            const suggestionBox = document.getElementById("prompt-suggestion");
            if (toolSelect && suggestionBox) {
                const selected = toolSelect.value;
                suggestionBox.textContent = `💡 Example: ${toolPrompts[selected] || ""}`;
            }
        }

        function updateCharCounter() {
            const input = document.getElementById('user-input');
            const counter = document.getElementById('char-count');
            if (input && counter) {
                counter.textContent = input.value.length;
                counter.style.color = input.value.length > 400 ? 'var(--warning-color)' : 'var(--text-muted)';
            }
        }

        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('password');
            const toggleBtn = document.getElementById('password-toggle');
            
            if (passwordInput && toggleBtn) {
                const isPassword = passwordInput.type === 'password';
                passwordInput.type = isPassword ? 'text' : 'password';
                toggleBtn.innerHTML = isPassword ? '🙈' : '👁️';
                toggleBtn.setAttribute('aria-label', isPassword ? 'Hide password' : 'Show password');
                toggleBtn.setAttribute('title', isPassword ? 'Hide password' : 'Show password');
            }
        }

        // String escaping utility
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function createFavoriteButton(question, answer, isImage = false) {
            const button = document.createElement('button');
            button.textContent = '💾 Save to Favorites';
            button.className = 'favorite-btn';
            button.style.cssText = `
                margin-top: 10px;
                margin-right: 10px;
                padding: 8px 16px;
                background: var(--gradient-secondary);
                color: var(--secondary-color);
                border: none;
                border-radius: 6px;
                cursor: pointer;
                font-weight: 600;
                transition: all var(--transition-base);
            `;
            
            button.onclick = function(e) {
                e.preventDefault();
                e.stopPropagation();
                saveFavorite(question, answer);
            };
            
            return button;
        }

        // Authentication functions
        async function register() {
            const emailInput = document.getElementById("email");
            const passwordInput = document.getElementById("password");
            const signUpBtn = document.getElementById("signup-btn");
            const loginBtn = document.getElementById("login-btn");
            
            if (!emailInput || !passwordInput || !signUpBtn || !loginBtn) return;
            
            // Clear previous errors
            document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
            
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();

            let hasError = false;

            if (!email) {
                document.getElementById('email-error').textContent = 'Email is required.';
                hasError = true;
            } else if (!isValidEmail(email)) {
                document.getElementById('email-error').textContent = 'Please enter a valid email address.';
                hasError = true;
            }
            
            if (!password) {
                document.getElementById('password-error').textContent = 'Password is required.';
                hasError = true;
            } else if (!isValidPassword(password)) {
                document.getElementById('password-error').textContent = 'Password must be at least 8 characters long.';
                hasError = true;
            }

            if (hasError) {
                emailInput.focus();
                return;
            }

            // Show loading state
            signUpBtn.disabled = true;
            loginBtn.disabled = true;
            const btnText = signUpBtn.querySelector('.btn-text');
            const btnLoader = signUpBtn.querySelector('.btn-loader');
            btnText.textContent = "Signing Up...";
            btnLoader.classList.remove('hidden');

            try {
                const response = await fetch("https://visionflow-backend-vdjh.onrender.com/register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (data.user && !data.error) {
                    localStorage.setItem("visionflowUser", JSON.stringify(data.user));
                    loggedInUser = data.user;
                    restoreSession();
                    emailInput.value = "";
                    passwordInput.value = "";
                    showToast("Welcome to VisionFlow! Account created successfully.", 'success');
                    setTimeout(() => {
                        const userInput = document.getElementById("user-input");
                        if (userInput) userInput.focus();
                    }, 300);
                } else {
                    showToast(data.error || "Registration failed. Please try again.", 'error');
                    emailInput.focus();
                }
            } catch (err) {
                showToast("Network error. Please check your connection and try again.", 'error');
                console.error('Registration error:', err);
                emailInput.focus();
            } finally {
                signUpBtn.disabled = false;
                loginBtn.disabled = false;
                btnText.textContent = "Sign Up";
                btnLoader.classList.add('hidden');
            }
        }

        async function login() {
            const emailInput = document.getElementById("email");
            const passwordInput = document.getElementById("password");
            const signUpBtn = document.getElementById("signup-btn");
            const loginBtn = document.getElementById("login-btn");
            
            if (!emailInput || !passwordInput || !signUpBtn || !loginBtn) return;
            
            // Clear previous errors
            document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
            
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();

            let hasError = false;

            if (!email) {
                document.getElementById('email-error').textContent = 'Email is required.';
                hasError = true;
            } else if (!isValidEmail(email)) {
                document.getElementById('email-error').textContent = 'Please enter a valid email address.';
                hasError = true;
            }
            
            if (!password) {
                document.getElementById('password-error').textContent = 'Password is required.';
                hasError = true;
            } else if (!isValidPassword(password)) {
                document.getElementById('password-error').textContent = 'Password must be at least 8 characters long.';
                hasError = true;
            }

            if (hasError) {
                emailInput.focus();
                return;
            }

            // Show loading state
            signUpBtn.disabled = true;
            loginBtn.disabled = true;
            const btnText = loginBtn.querySelector('.btn-text');
            const btnLoader = loginBtn.querySelector('.btn-loader');
            btnText.textContent = "Logging In...";
            btnLoader.classList.remove('hidden');

            try {
                const response = await fetch("https://visionflow-backend-vdjh.onrender.com/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (data.user) {
                    localStorage.setItem("visionflowUser", JSON.stringify(data.user));
                    loggedInUser = data.user;
                    restoreSession();
                    const chatBox = document.getElementById("chat-box");
                    if (chatBox) chatBox.innerHTML = "";
                    setTimeout(() => loadChatHistory(), 100);
                    emailInput.value = "";
                    passwordInput.value = "";
                    showToast("Welcome back to VisionFlow!", 'success');
                    setTimeout(() => {
                        const userInput = document.getElementById("user-input");
                        if (userInput) userInput.focus();
                    }, 300);
                } else {
                    showToast(data.error || "Login failed. Please check your credentials.", 'error');
                    passwordInput.focus();
                }
            } catch (err) {
                showToast("Network error. Please check your connection and try again.", 'error');
                console.error('Login error:', err);
                emailInput.focus();
            } finally {
                signUpBtn.disabled = false;
                loginBtn.disabled = false;
                btnText.textContent = "Login";
                btnLoader.classList.add('hidden');
            }
        }

        function logout() {
            localStorage.removeItem("visionflowUser");
            loggedInUser = null;
            restoreSession();
            const chatBox = document.getElementById("chat-box");
            if (chatBox) {
                chatBox.innerHTML = `
                    <div class="chat-welcome">
                        <h3>Welcome to VisionFlow AI! 🚀</h3>
                        <p>Select a tool above and start building your business idea.</p>
                    </div>
                `;
            }
            showToast("You've been logged out successfully.", 'success');
        }

        // Chat functionality
        function generatePrompt(tool, input) {
            switch (tool) {
                case "cofounder":
                    return `You are my AI cofounder. Help me brainstorm ideas, strategies, and solutions for my startup. My current challenge is: ${input}`;
                case "motivator":
                    return `You are my supportive and encouraging AI motivator friend. Your role is to provide uplifting, positive, and motivational responses to help me stay focused and inspired on my entrepreneurial journey. Here's what I'm dealing with: ${input}`;
                case "idea":
                    return `You're a startup idea machine. Give 3 creative, profitable startup ideas for: ${input}`;
                case "market":
                    return `You're a market research expert. Provide competitor analysis, audience, and trends for: ${input}`;
                case "mvp":
                    return `Act as a product manager. Create an MVP launch plan for: ${input}`;
                case "gtm":
                    return `Act as a growth hacker. Create a launch strategy and ad copy for: ${input}`;
                case "brand":
                    return `Act as a brand strategist. For "${input}", provide name, slogan, colors, fonts, tone.`;
                case "step":
                    return `You are a startup mentor. Give me a step-by-step launch guide for: ${input}. Make it scalable for growth, include automation/delegation tips, and break it into phases: validation, MVP, growth, and scaling. Each step should be actionable and specific.`;
                case "pitch":
                    return `Startup strategist. Generate a 10-slide pitch deck for: ${input}`;
                case "plan":
                    return `You're a business analyst. Write a full business plan for: ${input}, including:\n1. Executive Summary\n2. Product/Service Description\n3. Target Market\n4. Market Analysis\n5. Competitive Advantage\n6. Operations Plan\n7. SWOT Analysis\n8. Financial Forecast\n9. Marketing Strategy\n10. Conclusion\n\nThen, provide a detailed 30-day action plan for launching and growing this business, with specific tasks and milestones for each day.`;
                case "adcopy":
                    return `You're a conversion-focused ad copywriter. Write 3 winning ad variants for: "${input}". Each ad should include:\n- A catchy Headline\n- Primary Text\n- A strong Call to Action`;
                case "logo":
                    return `Generate a clean, modern logo for the brand: "${input}". The logo should be abstract and reflect the brand visually without including any text or letters. Focus on symbolism and brand personality.`;
                case "resume":
                    return `Professional resume writer. Write a full ATS-optimized resume for: ${input}`;
                case "winning":
                    return `You are a product research expert. Find 5 winning or trending products that are real shortcuts, solve a big problem, and have a 'wow' factor for: ${input}. For each, explain why it's a shortcut, what problem it solves, and what makes it a wow product (e.g., viral, unique, or untapped market).`;
                case "legal":
                    return `You're a legal document generator. Write full legal documents including Terms of Service, Privacy Policy, and Cookie Notice for: ${input}. The company should be compliant with global privacy laws (e.g., GDPR, CCPA). Keep the output clear and legally sound.`;
                case "name":
                    return `You are a creative naming assistant. Suggest 10 unique, brandable product names for: ${input}. Make sure the names are short, catchy, and sound like startup brands.`;
                case "email":
                    return `You are an expert cold email copywriter. Write a personalized, persuasive email for: ${input}`;
                case "landing":
                    return `You are a conversion copywriting expert. Write a full landing page copy (headline, subheadline, bullet points, call-to-action) for: ${input}`;
                case "digitalproduct":
                    return `You're a digital product strategist. Suggest 5 profitable digital products for this niche or idea: ${input}. For each product, include what it is, target audience, how to sell it, and why it would work.`;
                case "valueprop":
                    return `You're a SaaS marketing expert. Generate a powerful, one-sentence value proposition for: ${input}. Use clear, outcome-driven language.`;
                case "validate":
                    return `You're a startup advisor. Validate this startup idea by checking if the problem is strong, and if the solution matches well. Give feedback and improvement tips. Idea: ${input}`;
                case "growth":
                    return `You're a growth hacker. Suggest 3 creative, low-cost growth strategies for: ${input}. Focus on viral marketing, community building, and user acquisition.`;
                case "funding":
                    return `You're an investor relations expert. Write a compelling email to angel investors for: ${input}. Highlight the problem, solution, market opportunity, and why they should invest.`;
                case "community":
                    return `You're a community builder. Suggest 5 creative ways to build an engaged community around: ${input}. Focus on online platforms, content strategies, and engagement tactics.`;
                case "scale":
                    return `You're a startup growth advisor. Create a scaling roadmap for: ${input}. Include: - Key growth milestones - Hiring suggestions - Platform expansion - Budget considerations - Revenue targets`;
                case "social":
                    return `You're a social media marketing expert. Create a comprehensive 30-day social media marketing strategy for: ${input}. For each day, specify the platform, post type, content idea, and engagement tactic. Include:
                    - Platform-specific tips (Instagram, TikTok, LinkedIn)
                    - Post types (reels, carousels, tweets)
                    - Hashtag recommendations
                    - Posting frequency and engagement hacks`;
                default:
                    return input;
            }
        }

        async function handleChatSubmit(e) {
            e.preventDefault();
            
            const savedUser = localStorage.getItem("visionflowUser");
            if (!savedUser) {
                showToast("Please login or sign up first.", 'error');
                restoreSession();
                return;
            }

            try {
                loggedInUser = JSON.parse(savedUser);
            } catch (e) {
                showToast("Please login or sign up first.", 'error');
                restoreSession();
                return;
            }

            if (!loggedInUser || !loggedInUser.email) {
                showToast("Please login or sign up first.", 'error');
                restoreSession();
                return;
            }

            const userInput = document.getElementById("user-input");
            const toolSelect = document.getElementById("tool-select");
            const chatBox = document.getElementById("chat-box");
            const sendBtn = document.getElementById("send-btn");
            
            if (!userInput || !toolSelect || !chatBox) return;
            
            const message = userInput.value.trim();
            const tool = toolSelect.value;
            
            if (!message) {
                userInput.focus();
                return;
            }

            const fullPrompt = generatePrompt(tool, message);
            
            // Add user message to chat
            chatBox.innerHTML += `<p><strong>You:</strong> ${escapeHtml(message)}</p>`;
            userInput.value = "";
            updateCharCounter();
            
            // Show loading state
            if (sendBtn) {
                sendBtn.disabled = true;
                sendBtn.innerHTML = '<span class="send-icon">⟳</span>';
                sendBtn.style.opacity = '0.6';
            }

            // Scroll to bottom
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                const response = await fetch("https://visionflow-backend-vdjh.onrender.com/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: fullPrompt, tool, email: loggedInUser.email })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Create container for response
                const responseContainer = document.createElement('div');
                
                if (tool === "logo" && data.image) {
                    responseContainer.innerHTML = `
                        <p><strong>VisionFlow:</strong></p>
                        <img id="generated-logo" src="${data.image}" alt="Generated Logo" style="max-width:100%; border-radius:8px; margin: 10px 0;" loading="lazy" />
                        <br><br>
                    `;
                    
                    // Create and append save button
                    const saveBtn = createFavoriteButton(message, data.image, true);
                    responseContainer.appendChild(saveBtn);
                    
                    // Create download buttons
                    const downloadPngBtn = document.createElement('button');
                    downloadPngBtn.textContent = '⬇️ Download PNG';
                    downloadPngBtn.onclick = () => downloadLogo('png');
                    downloadPngBtn.style.cssText = `
                        margin-right: 10px;
                        padding: 8px 16px;
                        background: var(--tertiary-color);
                        color: var(--primary-color);
                        border: 1px solid rgba(255, 215, 0, 0.3);
                        border-radius: 6px;
                        cursor: pointer;
                        font-weight: 600;
                    `;
                    
                    const downloadJpgBtn = document.createElement('button');
                    downloadJpgBtn.textContent = '⬇️ Download JPG';
                    downloadJpgBtn.onclick = () => downloadLogo('jpg');
                    downloadJpgBtn.style.cssText = `
                        padding: 8px 16px;
                        background: var(--tertiary-color);
                        color: var(--primary-color);
                        border: 1px solid rgba(255, 215, 0, 0.3);
                        border-radius: 6px;
                        cursor: pointer;
                        font-weight: 600;
                    `;
                    
                    responseContainer.appendChild(downloadPngBtn);
                    responseContainer.appendChild(downloadJpgBtn);
                    
                } else if (data.reply) {
                    responseContainer.innerHTML = `
                        <p><strong>VisionFlow:</strong></p>
                        <pre style="white-space: pre-wrap; word-wrap: break-word;">${escapeHtml(data.reply)}</pre>
                    `;
                    
                    // Create and append save button
                    const saveBtn = createFavoriteButton(message, data.reply);
                    responseContainer.appendChild(saveBtn);
                    
                } else {
                    responseContainer.innerHTML = `<p><strong>VisionFlow:</strong> I apologize, but I encountered an issue processing your request. Please try again.</p>`;
                }
                
                chatBox.appendChild(responseContainer);
                chatBox.scrollTop = chatBox.scrollHeight;
                
                // Show success toast
                showToast("Response generated successfully!", 'success', 3000);
                
            } catch (err) {
                console.error('Chat error:', err);
                chatBox.innerHTML += `<p><strong>VisionFlow:</strong> <span style="color: var(--error-color);">I'm experiencing technical difficulties. Please check your connection and try again.</span></p>`;
                chatBox.scrollTop = chatBox.scrollHeight;
                showToast("Error communicating with AI. Please try again.", 'error');
            } finally {
                // Reset loading state
                if (sendBtn) {
                    sendBtn.disabled = false;
                    sendBtn.innerHTML = '<span class="send-icon">→</span>';
                    sendBtn.style.opacity = '1';
                }
                userInput.focus();
            }
        }

        // Favorites functionality
        async function saveFavorite(question, answer) {
            if (!loggedInUser || !loggedInUser.email) {
                showToast("Please login to save favorites.", 'error');
                return;
            }

            try {
                const response = await fetch("https://visionflow-backend-vdjh.onrender.com/save-favorite", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ question, answer, email: loggedInUser.email })
                });
                
                const data = await response.json();
                
                if (data.message) {
                    showToast(data.message, 'success', 3000);
                } else {
                    showToast(data.error || "Failed to save favorite.", 'error');
                }
            } catch (err) {
                console.error('Save favorite error:', err);
                showToast("Network error. Please try again.", 'error');
            }
        }

        async function viewFavorites() {
            if (!loggedInUser || !loggedInUser.email) {
                showToast("Please login to view favorites.", 'error');
                return;
            }

            showLoading(true);

            try {
                const response = await fetch("https://visionflow-backend-vdjh.onrender.com/favorites", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email: loggedInUser.email })
                });
                
                const data = await response.json();
                favorites = data.favorites || [];
                const list = document.getElementById("favorites-list");
                
                if (list) {
                    list.classList.remove('hidden');
                    list.innerHTML = "";
                    
                    if (favorites.length === 0) {
                        list.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                                <p>📂 No favorites saved yet.</p>
                                <p>Start a conversation and save responses to see them here!</p>
                            </div>
                        `;
                    } else {
                        favorites.forEach((f, index) => {
                            const li = document.createElement("li");
                            li.innerHTML = `
                                <div style="margin-bottom: 12px;">
                                    <strong style="color: var(--primary-color);">Q:</strong> ${escapeHtml(f.question)}
                                </div>
                                <div style="margin-bottom: 12px; padding: 10px; background: rgba(255, 215, 0, 0.05); border-radius: 6px; border-left: 3px solid var(--primary-color);">
                                    <strong style="color: var(--text-secondary);">A:</strong> ${escapeHtml(f.answer.length > 200 ? f.answer.substring(0, 200) + '...' : f.answer)}
                                </div>
                            `;
                            
                            // Create action buttons
                            const actionDiv = document.createElement('div');
                            actionDiv.style.cssText = 'display: flex; gap: 8px; flex-wrap: wrap;';
                            
                            const deleteBtn = document.createElement('button');
                            deleteBtn.textContent = '❌ Delete';
                            deleteBtn.onclick = () => deleteFavorite(f.question);
                            
                            const copyBtn = document.createElement('button');
                            copyBtn.textContent = '📋 Copy Answer';
                            copyBtn.onclick = () => copyToClipboard(f.answer);
                            
                            actionDiv.appendChild(deleteBtn);
                            actionDiv.appendChild(copyBtn);
                            li.appendChild(actionDiv);
                            
                            list.appendChild(li);
                        });
                        
                        // Scroll to favorites
                        list.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        showToast(`Found ${favorites.length} favorites.`, 'success', 3000);
                    }
                }
            } catch (err) {
                console.error('View favorites error:', err);
                showToast("Network error. Please try again.", 'error');
            } finally {
                showLoading(false);
            }
        }

        async function deleteFavorite(question) {
            if (!loggedInUser || !loggedInUser.email) {
                showToast("Please login to delete favorites.", 'error');
                return;
            }

            if (!confirm("Are you sure you want to delete this favorite?")) {
                return;
            }

            try {
                const response = await fetch("https://visionflow-backend-vdjh.onrender.com/delete-favorite", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ question, email: loggedInUser.email })
                });
                
                const data = await response.json();
                
                if (data.message) {
                    showToast(data.message, 'success', 3000);
                    viewFavorites(); // Refresh the list
                } else {
                    showToast(data.error || "Failed to delete favorite.", 'error');
                }
            } catch (err) {
                console.error('Delete favorite error:', err);
                showToast("Network error. Please try again.", 'error');
            }
        }

        async function clearFavorites() {
            if (!loggedInUser || !loggedInUser.email) {
                showToast("Please login to clear favorites.", 'error');
                return;
            }

            if (!confirm("Are you sure you want to clear all favorites? This action cannot be undone.")) {
                return;
            }

            showLoading(true);

            try {
                const response = await fetch("https://visionflow-backend-vdjh.onrender.com/clear-favorites", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email: loggedInUser.email })
                });
                
                const data = await response.json();
                
                if (data.message) {
                    showToast(data.message, 'success');
                    const list = document.getElementById("favorites-list");
                    if (list) {
                        list.classList.add('hidden');
                        list.innerHTML = "";
                    }
                } else {
                    showToast(data.error || "Failed to clear favorites.", 'error');
                }
            } catch (err) {
                console.error('Clear favorites error:', err);
                showToast("Network error. Please try again.", 'error');
            } finally {
                showLoading(false);
            }
        }

        // Export functions
        function exportToTXT() {
            if (favorites.length === 0) {
                showToast("No favorites to export. Start saving some responses first!", 'warning');
                return;
            }
            
            const content = favorites.map(f => `Q: ${f.question}\nA: ${f.answer}\n\n---\n\n`).join("");
            downloadFile("visionflow-favorites.txt", content);
            showToast("Favorites exported to TXT file!", 'success', 3000);
        }

        function exportToCSV() {
            if (favorites.length === 0) {
                showToast("No favorites to export. Start saving some responses first!", 'warning');
                return;
            }
            
            const csv = "Question,Answer\n" + favorites.map(f => 
                `"${f.question.replace(/"/g, '""')}","${f.answer.replace(/"/g, '""')}"`
            ).join("\n");
            downloadFile("visionflow-favorites.csv", csv);
            showToast("Favorites exported to CSV file!", 'success', 3000);
        }

        function exportToPDF() {
            if (favorites.length === 0) {
                showToast("No favorites to export. Start saving some responses first!", 'warning');
                return;
            }

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                let y = 20;
                
                // Add title
                doc.setFontSize(18);
                doc.setTextColor(255, 215, 0);
                doc.text("VisionFlow AI - Favorites", 20, y);
                y += 20;
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                
                favorites.forEach((fav, index) => {
                    // Add question
                    doc.setFont(undefined, 'bold');
                    const qText = `Q${index + 1}: ${fav.question}`;
                    const qLines = doc.splitTextToSize(qText, 170);
                    doc.text(qLines, 20, y);
                    y += qLines.length * 7 + 5;
                    
                    // Add answer
                    doc.setFont(undefined, 'normal');
                    const aText = `A: ${fav.answer}`;
                    const aLines = doc.splitTextToSize(aText, 170);
                    doc.text(aLines, 20, y);
                    y += aLines.length * 7 + 15;
                    
                    // Add new page if needed
                    if (y > 270) { 
                        doc.addPage(); 
                        y = 20; 
                    }
                });
                
                doc.save("visionflow-favorites.pdf");
                showToast("Favorites exported to PDF file!", 'success', 3000);
            } catch (err) {
                console.error('PDF export error:', err);
                showToast("Error exporting to PDF. Please try again.", 'error');
            }
        }

        function downloadFile(filename, content) {
            try {
                const blob = new Blob([content], { type: "text/plain" });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(link.href);
            } catch (err) {
                console.error('Download error:', err);
                showToast("Error downloading file. Please try again.", 'error');
            }
        }

        // Logo download function
        async function downloadLogo(format) {
            const img = document.getElementById("generated-logo");
            if (!img || !img.src) {
                showToast("No logo found to download.", 'error');
                return;
            }

            try {
                showLoading(true);
                const response = await fetch(img.src);
                const blob = await response.blob();
                
                if (format === "png") {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement("a");
                    link.href = url;
                    link.download = "visionflow-logo.png";
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    showToast("Logo downloaded as PNG!", 'success', 3000);
                } else {
                    const url = URL.createObjectURL(blob);
                    const image = new Image();
                    image.onload = function() {
                        const canvas = document.createElement("canvas");
                        canvas.width = image.width;
                        canvas.height = image.height;
                        const ctx = canvas.getContext("2d");
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(image, 0, 0);
                        const dataUrl = canvas.toDataURL("image/jpeg", 0.95);
                        const link = document.createElement("a");
                        link.href = dataUrl;
                        link.download = "visionflow-logo.jpg";
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                        showToast("Logo downloaded as JPG!", 'success', 3000);
                    };
                    image.src = url;
                }
            } catch (err) {
                console.error('Logo download error:', err);
                showToast("Failed to download logo. Please try again.", 'error');
            } finally {
                showLoading(false);
            }
        }

        // Chat history functions
        async function loadChatHistory() {
            if (!loggedInUser || !loggedInUser.email) {
                const chatBox = document.getElementById("chat-box");
                if (chatBox) {
                    chatBox.innerHTML = `
                        <div class="chat-welcome">
                            <h3>Welcome to VisionFlow AI! 🚀</h3>
                            <p>Select a tool above and start building your business idea.</p>
                        </div>
                    `;
                }
                return;
            }

            try {
                const response = await fetch("https://visionflow-backend-vdjh.onrender.com/chat-history", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email: loggedInUser.email })
                });
                
                const data = await response.json();
                const history = data.history || [];
                const chatBox = document.getElementById("chat-box");
                
                if (chatBox) {
                    if (history.length === 0) {
                        chatBox.innerHTML = `
                            <div class="chat-welcome">
                                <h3>Welcome back to VisionFlow AI! 🚀</h3>
                                <p>Select a tool above and start building your business idea.</p>
                            </div>
                        `;
                    } else {
                        let output = `<div style="text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(255, 215, 0, 0.1); border-radius: 8px; border: 1px solid rgba(255, 215, 0, 0.2);">
                            <h3 style="color: var(--primary-color); margin-bottom: 8px;">📜 Your Chat History</h3>
                            <p style="color: var(--text-secondary); font-size: 0.875rem; margin: 0;">Recent conversations with VisionFlow AI</p>
                        </div>`;
                        
                        history.slice(-10).forEach((item, index) => {
                            output += `
                                <div style="margin-bottom: 20px; padding: 15px; background: rgba(255, 215, 0, 0.05); border-radius: 8px; border-left: 3px solid var(--primary-color);">
                                    <div style="font-size: 0.875rem; color: var(--text-muted); margin-bottom: 8px;">
                                        Tool: <strong style="color: var(--primary-color);">${escapeHtml(item.tool)}</strong>
                                    </div>
                                    <p><strong style="color: var(--primary-color);">You:</strong> ${escapeHtml(item.user_input)}</p>
                                    <p><strong style="color: var(--text-secondary);">VisionFlow:</strong></p>
                                    <pre style="white-space: pre-wrap; word-wrap: break-word; margin: 8px 0;">${escapeHtml(item.ai_reply)}</pre>
                                </div>
                            `;
                        });
                        
                        if (history.length > 10) {
                            output += `<div style="text-align: center; color: var(--text-muted); font-size: 0.875rem; margin-top: 20px;">
                                Showing last 10 conversations. Total: ${history.length}
                            </div>`;
                        }
                        
                        chatBox.innerHTML = output;
                    }
                    chatBox.scrollTop = chatBox.scrollHeight;
                }
            } catch (err) {
                console.error('Load chat history error:', err);
                const chatBox = document.getElementById("chat-box");
                if (chatBox) {
                    chatBox.innerHTML = `
                        <div class="chat-welcome">
                            <h3>Welcome back to VisionFlow AI! 🚀</h3>
                            <p>Select a tool above and start building your business idea.</p>
                            <p style="color: var(--error-color); font-size: 0.875rem; margin-top: 10px;">Unable to load chat history.</p>
                        </div>
                    `;
                }
            }
        }

        // Copy to clipboard function
        function copyToClipboard(text) {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast("Copied to clipboard!", 'success', 2000);
                }).catch(err => {
                    console.error('Copy error:', err);
                    fallbackCopyTextToClipboard(text);
                });
            } else {
                fallbackCopyTextToClipboard(text);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-999999px";
            textArea.style.top = "-999999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showToast("Copied to clipboard!", 'success', 2000);
                } else {
                    showToast("Failed to copy to clipboard.", 'error');
                }
            } catch (err) {
                console.error('Fallback copy error:', err);
                showToast("Failed to copy to clipboard.", 'error');
            }
            
            document.body.removeChild(textArea);
        }

        // Event handlers
        function attachEventHandlers() {
            const signupBtn = document.getElementById("signup-btn");
            const loginBtn = document.getElementById("login-btn");
            const logoutButton = document.getElementById("logout-button");
            const chatForm = document.getElementById("chat-form");
            const viewFavoritesBtn = document.getElementById("view-favorites-btn");
            const clearFavoritesBtn = document.getElementById("clear-favorites-btn");
            const exportTxtBtn = document.getElementById("export-txt-btn");
            const exportCsvBtn = document.getElementById("export-csv-btn");
            const exportPdfBtn = document.getElementById("export-pdf-btn");
            const toggleTheme = document.getElementById("toggle-theme");
            const toolSelect = document.getElementById("tool-select");
            const userInput = document.getElementById("user-input");
            const passwordToggle = document.getElementById("password-toggle");

            if (signupBtn) signupBtn.onclick = register;
            if (loginBtn) loginBtn.onclick = login;
            if (logoutButton) logoutButton.onclick = logout;
            if (chatForm) chatForm.onsubmit = handleChatSubmit;
            if (viewFavoritesBtn) viewFavoritesBtn.onclick = viewFavorites;
            if (clearFavoritesBtn) clearFavoritesBtn.onclick = clearFavorites;
            if (exportTxtBtn) exportTxtBtn.onclick = exportToTXT;
            if (exportCsvBtn) exportCsvBtn.onclick = exportToCSV;
            if (exportPdfBtn) exportPdfBtn.onclick = exportToPDF;
            if (toolSelect) toolSelect.onchange = updateToolUI;
            if (userInput) userInput.oninput = updateCharCounter;
            if (passwordToggle) passwordToggle.onclick = togglePasswordVisibility;
            
            if (toggleTheme) {
                toggleTheme.onclick = () => {
                    if (document.body.classList.contains("light-mode")) {
                        document.body.classList.remove("light-mode");
                        localStorage.setItem('theme', 'dark');
                    } else {
                        document.body.classList.add("light-mode");
                        localStorage.setItem('theme', 'light');
                    }
                    updateThemeButton();
                };
            }

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl/Cmd + Enter to send message
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    const chatForm = document.getElementById('chat-form');
                    if (chatForm && !document.getElementById('auth-section').classList.contains('hidden') === false) {
                        chatForm.dispatchEvent(new Event('submit'));
                    }
                }
                
                // Escape to hide favorites
                if (e.key === 'Escape') {
                    const favoritesList = document.getElementById('favorites-list');
                    if (favoritesList && !favoritesList.classList.contains('hidden')) {
                        favoritesList.classList.add('hidden');
                    }
                }
            });

            // Form validation
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            
            if (emailInput) {
                emailInput.setAttribute('tabindex', '1');
                emailInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && passwordInput) {
                        passwordInput.focus();
                    }
                });
                
                emailInput.addEventListener('blur', function() {
                    const emailError = document.getElementById('email-error');
                    if (this.value && !isValidEmail(this.value)) {
                        emailError.textContent = 'Please enter a valid email address.';
                    } else {
                        emailError.textContent = '';
                    }
                });
            }
            
            if (passwordInput) {
                passwordInput.setAttribute('tabindex', '2');
                passwordInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        login();
                    }
                });
                
                passwordInput.addEventListener('blur', function() {
                    const passwordError = document.getElementById('password-error');
                    if (this.value && !isValidPassword(this.value)) {
                        passwordError.textContent = 'Password must be at least 8 characters long.';
                    } else {
                        passwordError.textContent = '';
                    }
                });
            }

            // Auto-resize chat input
            if (userInput) {
                userInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 120) + 'px';
                });
            }
        }

        // Initialize app
        window.addEventListener("DOMContentLoaded", () => {
            restoreSession();
            
            // Restore theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
            }
            updateThemeButton();
            
            attachEventHandlers();
            updateToolUI();
            updateCharCounter();

            // Performance optimization: lazy load
            setTimeout(() => {
                const images = document.querySelectorAll('img[loading="lazy"]');
                if ('IntersectionObserver' in window) {
                    const imageObserver = new IntersectionObserver((entries, observer) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const img = entry.target;
                                img.src = img.dataset.src || img.src;
                                img.classList.remove('lazy');
                                imageObserver.unobserve(img);
                            }
                        });
                    });
                    
                    images.forEach(img => imageObserver.observe(img));
                }
            }, 1000);

            // Show welcome message after a delay
            setTimeout(() => {
                const authSection = document.getElementById('auth-section');
                if (authSection && !authSection.classList.contains('hidden')) {
                    showToast("Welcome to VisionFlow AI! Create an account to get started.", 'info', 5000);
                }
            }, 2000);
        });

        // Make functions globally available
        window.saveFavorite = saveFavorite;
        window.deleteFavorite = deleteFavorite;
        window.downloadLogo = downloadLogo;
        window.copyToClipboard = copyToClipboard;

        // Service Worker registration for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js').then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }

        // Handle online/offline status
        window.addEventListener('online', function() {
            showToast("Connection restored!", 'success', 3000);
        });

        window.addEventListener('offline', function() {
            showToast("You're offline. Some features may not work.", 'warning', 5000);
        });
    </script>
</body>
</html>
