<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0"/>
  <title>VisionFlow AI</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap');
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, #18122B 0%, #22223B 100%);
      color: #f5f3e7;
      padding: 16px;
      margin: 0;
      min-height: 100vh;
      line-height: 1.6;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(24, 18, 43, 0.3);
      border-radius: 24px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.25);
      backdrop-filter: blur(10px);
      padding: 20px;
    }
    
    .logo-header {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .vision-logo {
      max-width: 160px;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 4px 24px #FFD70044, 0 1.5px 8px #0006;
      border: 2px solid #FFD70044;
      background: #fffbe6;
      padding: 8px;
      object-fit: contain;
    }
    
    h1 {
      font-family: 'Playfair Display', serif;
      font-size: clamp(1.8rem, 4vw, 2.5rem);
      letter-spacing: 1px;
      color: #FFD700;
      text-shadow: 0 2px 16px #0008;
      margin: 0 0 16px 0;
      text-align: center;
    }
    
    .subtitle {
      text-align: center;
      font-size: clamp(0.9rem, 2.5vw, 1.1rem);
      color: #bfa14a;
      margin-bottom: 20px;
      font-weight: 500;
    }
    
    .theme-toggle-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    #toggle-theme {
      background: linear-gradient(90deg, #FFD700 0%, #bfa14a 100%);
      color: #18122B;
      border-radius: 12px;
      font-size: clamp(0.9rem, 2.5vw, 1rem);
      font-weight: 600;
      border: none;
      box-shadow: 0 2px 8px #FFD70022;
      padding: 12px 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    
    #toggle-theme:hover, #toggle-theme:focus {
      background: linear-gradient(90deg, #bfa14a 0%, #FFD700 100%);
      color: #23213a;
      box-shadow: 0 4px 16px #FFD70044;
      transform: translateY(-2px);
    }
    
    #chat-box {
      background: rgba(24, 18, 43, 0.85);
      border: 1.5px solid #FFD70044;
      border-radius: 18px;
      padding: 16px;
      height: clamp(250px, 40vh, 400px);
      overflow-y: auto;
      margin-bottom: 16px;
      white-space: pre-wrap;
      box-shadow: 0 2px 16px #0004;
      font-size: clamp(0.9rem, 2.5vw, 1rem);
      scrollbar-width: thin;
      scrollbar-color: #FFD700 transparent;
    }
    
    #chat-box::-webkit-scrollbar {
      width: 6px;
    }
    
    #chat-box::-webkit-scrollbar-track {
      background: transparent;
    }
    
    #chat-box::-webkit-scrollbar-thumb {
      background: #FFD700;
      border-radius: 3px;
    }
    
    input, button, select {
      padding: 14px 16px;
      margin: 8px 0;
      width: 100%;
      border-radius: 12px;
      border: none;
      font-size: clamp(0.9rem, 2.5vw, 1rem);
      font-family: 'Montserrat', sans-serif;
      outline: none;
      transition: all 0.3s ease;
    }
    
    input, select {
      background: #23213a;
      color: #FFD700;
      border: 1.5px solid #FFD70033;
      box-shadow: 0 1px 4px #0002;
    }
    
    input:focus, select:focus {
      border: 1.5px solid #FFD700;
      box-shadow: 0 2px 8px #FFD70033;
      transform: translateY(-1px);
    }
    
    button {
      background: linear-gradient(90deg, #FFD700 0%, #bfa14a 100%);
      color: #18122B;
      font-weight: 600;
      letter-spacing: 0.5px;
      border: none;
      cursor: pointer;
      box-shadow: 0 2px 8px #FFD70022;
      transition: all 0.3s ease;
    }
    
    button:hover, button:focus {
      background: linear-gradient(90deg, #bfa14a 0%, #FFD700 100%);
      color: #22223B;
      box-shadow: 0 4px 16px #FFD70044;
      transform: translateY(-2px);
    }
    
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    #auth-section, #main-section {
      background: rgba(34, 34, 59, 0.92);
      border-radius: 18px;
      box-shadow: 0 2px 16px #0006;
      padding: 24px;
      margin-bottom: 24px;
      backdrop-filter: blur(5px);
    }
    
    .hidden { 
      display: none !important; 
    }
    
    #favorites-list {
      background: rgba(24, 18, 43, 0.7);
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
      color: #FFD700;
      font-size: clamp(0.9rem, 2.5vw, 1rem);
      box-shadow: 0 1px 8px #FFD70022;
      max-height: 300px;
      overflow-y: auto;
    }
    
    #favorites-list li {
      margin-bottom: 12px;
      border-bottom: 1px solid #FFD70033;
      padding-bottom: 12px;
      word-wrap: break-word;
    }
    
    #favorites-list button {
      width: auto;
      margin: 8px 4px 0 0;
      padding: 8px 16px;
      font-size: clamp(0.8rem, 2vw, 0.9rem);
      border-radius: 8px;
      display: inline-block;
    }
    
    #logout-button {
      background: linear-gradient(90deg, #23213a 0%, #FFD700 100%);
      color: #FFD700;
      border: 1.5px solid #FFD70044;
      width: auto;
      padding: 12px 20px;
      border-radius: 12px;
      font-size: clamp(0.9rem, 2.5vw, 1rem);
      font-weight: 600;
      box-shadow: 0 2px 8px #FFD70022;
      margin-bottom: 16px;
    }
    
    #logout-button:hover, #logout-button:focus {
      background: linear-gradient(90deg, #FFD700 0%, #23213a 100%);
      color: #23213a;
      border: 1.5px solid #FFD700;
    }
    
    #prompt-suggestion {
      color: #FFD700;
      font-size: clamp(0.9rem, 2.5vw, 1rem);
      margin-bottom: 12px;
      font-family: 'Montserrat', sans-serif;
      letter-spacing: 0.3px;
      padding: 12px;
      background: rgba(255, 215, 0, 0.1);
      border-radius: 8px;
      border-left: 3px solid #FFD700;
    }
    
    #chat-form {
      display: flex;
      gap: 12px;
      align-items: stretch;
      flex-wrap: wrap;
    }
    
    #chat-form input[type="text"] {
      flex: 1;
      margin: 0;
      min-width: 200px;
    }
    
    #chat-form button {
      width: auto;
      padding: 14px 24px;
      margin: 0;
      border-radius: 12px;
      font-size: clamp(0.9rem, 2.5vw, 1rem);
      white-space: nowrap;
      min-width: 80px;
    }
    
    .button-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }
    
    .button-grid button {
      margin: 0;
      padding: 12px 16px;
      font-size: clamp(0.8rem, 2vw, 0.95rem);
    }
    
    /* VisionFlow answer styling */
    #chat-box pre {
      background: rgba(34,34,59,0.92);
      color: #FFD700;
      border-radius: 10px;
      padding: 12px 16px;
      margin: 10px 0;
      font-size: clamp(0.85rem, 2vw, 1rem);
      font-family: 'Montserrat', 'Consolas', monospace;
      box-shadow: 0 1px 8px #FFD70022;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    
    #chat-box img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 10px 0;
    }
    
    /* Light mode styles */
    body.light-mode {
      background: linear-gradient(135deg, #fffbe6 0%, #f7f7fa 100%);
      color: #23213a;
    }
    
    body.light-mode .container {
      background: rgba(255, 255, 255, 0.3);
    }
    
    body.light-mode #auth-section,
    body.light-mode #main-section {
      background: rgba(255, 255, 255, 0.95);
      box-shadow: 0 2px 16px #FFD70033;
      color: #23213a;
    }
    
    body.light-mode #chat-box {
      background: #fffbe6;
      border: 1.5px solid #bfa14a;
      color: #23213a;
    }
    
    body.light-mode #chat-box pre {
      background: #fffbe6;
      color: #23213a;
      border: 1.5px solid #bfa14a;
      box-shadow: 0 1px 8px #FFD70022;
    }
    
    body.light-mode input, body.light-mode select {
      background: #f7f7fa;
      color: #bfa14a;
      border: 1.5px solid #bfa14a44;
    }
    
    body.light-mode input:focus, body.light-mode select:focus {
      border: 1.5px solid #FFD700;
      box-shadow: 0 2px 8px #FFD70033;
    }
    
    body.light-mode button {
      background: linear-gradient(90deg, #bfa14a 0%, #FFD700 100%);
      color: #23213a;
      box-shadow: 0 2px 8px #FFD70022;
    }
    
    body.light-mode button:hover, body.light-mode button:focus {
      background: linear-gradient(90deg, #FFD700 0%, #bfa14a 100%);
      color: #fffbe6;
      box-shadow: 0 4px 16px #FFD70044;
    }
    
    body.light-mode #favorites-list {
      background: #fffbe6;
      color: #bfa14a;
      box-shadow: 0 1px 8px #FFD70022;
    }
    
    body.light-mode #favorites-list li {
      border-bottom: 1px solid #bfa14a44;
    }
    
    body.light-mode #logout-button {
      background: linear-gradient(90deg, #FFD700 0%, #fffbe6 100%);
      color: #bfa14a;
      border: 1.5px solid #FFD70044;
    }
    
    body.light-mode #logout-button:hover, body.light-mode #logout-button:focus {
      background: linear-gradient(90deg, #fffbe6 0%, #FFD700 100%);
      color: #FFD700;
      border: 1.5px solid #FFD700;
    }
    
    body.light-mode #toggle-theme {
      background: linear-gradient(90deg, #fffbe6 0%, #FFD700 100%);
      color: #bfa14a;
      box-shadow: 0 2px 8px #FFD70022;
    }
    
    body.light-mode #toggle-theme:hover, body.light-mode #toggle-theme:focus {
      background: linear-gradient(90deg, #FFD700 0%, #fffbe6 100%);
      color: #23213a;
      box-shadow: 0 4px 16px #FFD70044;
    }
    
    body.light-mode #prompt-suggestion {
      color: #bfa14a;
      background: rgba(191, 161, 74, 0.1);
      border-left: 3px solid #bfa14a;
    }
    
    /* Footer Styles */
    .site-footer {
      background: linear-gradient(135deg, #18122B 0%, #22223B 100%);
      border-top: 1.5px solid #23213a;
      padding: 32px 16px 24px 16px;
      text-align: center;
      color: #f5f3e7;
      font-size: clamp(0.9rem, 2.5vw, 1rem);
      margin-top: 40px;
      border-radius: 24px 24px 0 0;
    }
    
    .footer-inner {
      max-width: 820px;
      margin: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }
    
    .footer-brand {
      font-weight: 600;
      letter-spacing: 0.5px;
      font-size: clamp(1rem, 2.5vw, 1.2rem);
      color: #FFD700;
    }
    
    .footer-links {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      align-items: center;
      font-size: clamp(0.85rem, 2vw, 1rem);
    }
    
    .footer-links a {
      color: #FFD700;
      text-decoration: none;
      padding: 8px 12px;
      border-radius: 6px;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    
    .footer-links a:hover, .footer-links a:focus {
      background: #FFD70033;
      color: #fffbe7;
      transform: translateY(-1px);
    }
    
    .footer-sep {
      color: #bfa14a;
      font-size: 1.1em;
      margin: 0 4px;
      user-select: none;
    }
    
    .footer-tagline {
      font-size: clamp(0.8rem, 2vw, 0.95rem);
      color: #bfa14a;
      margin-top: 8px;
      letter-spacing: 0.2px;
    }
    
    body.light-mode .site-footer {
      background: linear-gradient(135deg, #fffbe6 0%, #f7f7fa 100%);
      color: #23213a;
      border-top: 1.5px solid #bfa14a;
    }
    
    body.light-mode .footer-brand {
      color: #bfa14a;
    }
    
    body.light-mode .footer-links a {
      color: #bfa14a;
    }
    
    body.light-mode .footer-links a:hover, body.light-mode .footer-links a:focus {
      background: #FFD70033;
      color: #FFD700;
    }
    
    body.light-mode .footer-tagline {
      color: #888;
    }
    
    /* Mobile Responsive Breakpoints */
    @media (max-width: 768px) {
      body {
        padding: 8px;
      }
      
      .container {
        padding: 16px;
        border-radius: 16px;
      }
      
      #auth-section, #main-section {
        padding: 20px 16px;
      }
      
      .logo-header {
        justify-content: center;
        text-align: center;
      }
      
      .vision-logo {
        max-width: 50px;
      }
      
      #chat-box {
        height: clamp(200px, 35vh, 300px);
        padding: 12px;
      }
      
      #chat-form {
        flex-direction: column;
        gap: 8px;
      }
      
      #chat-form input[type="text"] {
        min-width: unset;
      }
      
      #chat-form button {
        width: 100%;
        min-width: unset;
      }
      
      .button-grid {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      
      #logout-button {
        width: 100%;
        margin-bottom: 16px;
      }
      
      .footer-links {
        flex-direction: column;
        gap: 8px;
      }
      
      .footer-sep {
        display: none;
      }
      
      input, button, select {
        padding: 16px;
        font-size: 16px; /* Prevents zoom on iOS */
      }
    }
    
    @media (max-width: 480px) {
      .container {
        padding: 12px;
      }
      
      #auth-section, #main-section {
        padding: 16px 12px;
      }
      
      #chat-box {
        height: clamp(180px, 30vh, 250px);
        padding: 10px;
      }
      
      .button-grid button {
        padding: 14px 12px;
      }
    }
    
    /* Accessibility improvements */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* High contrast mode support */
    @media (prefers-contrast: high) {
      input, select {
        border-width: 2px;
      }
      
      button {
        border: 2px solid #FFD700;
      }
    }
    
    /* Focus indicators for keyboard navigation */
    *:focus {
      outline: 2px solid #FFD700;
      outline-offset: 2px;
    }
    
    button:focus, input:focus, select:focus {
      outline: 2px solid #FFD700;
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo-header">
      <img src="vision logo.jpeg" alt="VisionFlow Logo" class="vision-logo" />
      <div>
        <h1>VisionFlow AI</h1>
        <div class="subtitle">Your all-in-one AI business, branding, and product toolkit</div>
      </div>
    </div>
    
    <div class="theme-toggle-container">
      <button id="toggle-theme" aria-label="Toggle dark/light mode">🌙 Toggle Dark Mode</button>
    </div>

    <div id="dashboard" style="display:none;">
      <div id="business-page" class="page-section" style="display:block;"></div>
      <div id="branding-page" class="page-section" style="display:none;"></div>
      <div id="product-page" class="page-section" style="display:none;"></div>
      <div id="tools-page" class="page-section" style="display:none;"></div>
      <div id="account-page" class="page-section" style="display:none;"></div>
    </div>

    <div id="auth-section">
      <input type="email" id="email" placeholder="Email" required aria-label="Email address" />
      <input type="password" id="password" placeholder="Password" required autocomplete="current-password" aria-label="Password" />
      <button id="signup-btn" type="button">Sign Up</button>
      <button id="login-btn" type="button">Login</button>
    </div>

    <button id="logout-button" class="hidden">Logout</button>
    
    <div id="main-section" class="hidden">
      <label for="tool-select"><strong>Choose Tool:</strong></label>
      <select id="tool-select" aria-label="Select AI tool">
        <option value="cofounder">AI Cofounder Chat</option>
        <option value="idea">Idea Engine</option>
        <option value="ideatester">Idea Tester</option>
        <option value="market">Market Research</option>
        <option value="mvp">MVP Planner</option>
        <option value="gtm">Go-to-Market Kit</option>
        <option value="brand">Brand Builder</option>
        <option value="step">Step-by-Step Guidance</option>
        <option value="pitch">Pitch Deck Generator</option>
        <option value="plan">Business Plan Writer</option>
        <option value="adcopy">Ad Copy Generator</option>
        <option value="logo">AI logo Generator</option>
        <option value="resume">Resume Generator</option>
        <option value="winning">Find Winning Product</option>
        <option value="legal">AI Legal/Terms Generator</option>
        <option value="name">AI Product Name Generator</option>
        <option value="email">AI Email & Outreach Generator</option>
        <option value="landing">Landing Page Copy Generator</option>
        <option value="digitalproduct">Digital Product Finder</option>
        <option value="valueprop">AI Value Proposition Generator</option>
        <option value="validate">Problem/Solution Validator</option>
        <option value="growth">Growth Hacking Ideas</option>
        <option value="funding">Funding & Investor Outreach</option>
        <option value="community">Community Building Ideas</option>
        <option value="scale">Scale Planner</option>
        <option value="social">Social Marketing Strategist</option>
      </select>
      
      <div id="prompt-suggestion"></div>
      
      <div id="chat-box" role="log" aria-live="polite" aria-label="Chat conversation"></div>
      
      <form id="chat-form">
        <input type="text" id="user-input" placeholder="Ask VisionFlow..." required aria-label="Enter your message" />
        <button id="send-btn" type="submit">Send</button>
      </form>
      
      <div class="button-grid">
        <button id="view-favorites-btn">📂 View Favorites</button>
        <button id="clear-favorites-btn">🗑 Clear Favorites</button>
        <button id="export-txt-btn">📄 Export to .txt</button>
        <button id="export-csv-btn">📊 Export to CSV</button>
        <button id="export-pdf-btn">🖨 Export to PDF</button>
      </div>
      
      <ul id="favorites-list" role="list" aria-label="Favorites list"></ul>
    </div>
  </div>

  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-brand">© 2025 <span style="color:#FFD700;">VisionFlow</span> — All rights reserved.</div>
      <div class="footer-links">
        <a href="privacy-policy.html">Privacy Policy</a>
        <span class="footer-sep">|</span>
        <a href="terms-of-service.html">Terms of Service</a>
        <span class="footer-sep">|</span>
        <a href="cookie-policy.html">Cookie Policy</a>
        <span class="footer-sep">|</span>
        <a href="refund-policy.html">Refund Policy</a>
        <span class="footer-sep">|</span>
        <a href="plan.html">Pricing</a>
        <span class="footer-sep">|</span>
        <a href="contact.html">Contact</a>
      </div>
      <div class="footer-tagline">Built by entrepreneurs, for entrepreneurs 🚀</div>
    </div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Global variables
    let loggedInUser = null;
    let favorites = [];

    // Utility functions
    function showPage(page) {
      document.querySelectorAll('.page-section').forEach(p => p.style.display = 'none');
      const targetPage = document.getElementById(page + '-page');
      if (targetPage) {
        targetPage.style.display = 'block';
      }
    }

    function showDashboard() {
      const authSection = document.getElementById('auth-section');
      const dashboard = document.getElementById('dashboard');
      if (authSection) authSection.style.display = 'none';
      if (dashboard) dashboard.style.display = 'block';
      showPage('business');
    }

    function showAuth() {
      const authSection = document.getElementById('auth-section');
      const dashboard = document.getElementById('dashboard');
      if (authSection) authSection.style.display = '';
      if (dashboard) dashboard.style.display = 'none';
    }

    function restoreSession() {
      const savedUser = localStorage.getItem("visionflowUser");
      const authSection = document.getElementById("auth-section");
      const mainSection = document.getElementById("main-section");
      const logoutButton = document.getElementById("logout-button");
      
      if (savedUser) {
        loggedInUser = JSON.parse(savedUser);
        if (authSection) authSection.classList.add("hidden");
        if (mainSection) mainSection.classList.remove("hidden");
        if (logoutButton) logoutButton.classList.remove("hidden");
      } else {
        loggedInUser = null;
        if (mainSection) mainSection.classList.add("hidden");
        if (authSection) authSection.classList.remove("hidden");
        if (logoutButton) logoutButton.classList.add("hidden");
      }
    }

    function updateThemeButton() {
      const btn = document.getElementById("toggle-theme");
      if (btn) {
        const isLight = document.body.classList.contains("light-mode");
        btn.textContent = isLight ? "🌙 Dark Mode" : "☀️ Light Mode";
      }
    }

    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function isValidPassword(password) {
      return password.length >= 8;
    }

    // Tool prompts
    const toolPrompts = {
      cofounder: "Ask anything about launching your startup idea.",
      scale: "Create a 6-month scaling roadmap for a fashion e-commerce startup.",
      idea: "Give me 3 business ideas for online tutoring.",
      ideatester: "Test my idea: An app that delivers groceries by drone in rural areas.",
      market: "Do market research for fitness tech startup.",
      mvp: "Create an MVP launch plan for a note-taking app.",
      gtm: "Write a go-to-market plan for my productivity tool.",
      brand: "Suggest branding for an AI fashion startup.",
      step: "Step-by-step launch for a dropshipping brand.",
      pitch: "Make a 10-slide pitch deck for a crypto wallet.",
      plan: "Write a full business plan for a pet supply store.",
      adcopy: "Create ad copy for my AI content generator.",
      logo: "Generate the best, clean, downloadable logo for a dropshipping brand called Fixora.",
      resume: "Write a resume for a software engineer with 2 years experience.",
      winning: "Find 5 winning products for a TikTok-friendly gadget store.",
      legal: "Generate a Privacy Policy and Terms for my mobile fitness app.",
      name: "Suggest 5 product names for a smart wearable ring.",
      email: "Write a cold outreach email to potential investors for my travel startup.",
      landing: "Generate a landing page copy for a smart home automation platform.",
      digitalproduct: "Find 5 digital product ideas for students and educators.",
      valueprop: "Generate a value proposition for my AI hiring platform.",
      validate: "Validate the problem and solution for my app that matches local tutors with students.",
      growth: "Suggest 3 growth hacking strategies for my e-commerce store.",
      funding: "Write an email to angel investors for my fintech startup.",
      community: "Give me ideas to build a community around my online course platform.",
      social: "Create a 30-day Instagram strategy for a fitness brand.",
    };

    function updateToolUI() {
      const toolSelect = document.getElementById("tool-select");
      const suggestionBox = document.getElementById("prompt-suggestion");
      if (toolSelect && suggestionBox) {
        const selected = toolSelect.value;
        suggestionBox.textContent = `💡 Example: ${toolPrompts[selected] || ""}`;
      }
    }

    // Authentication functions
    async function register() {
      const emailInput = document.getElementById("email");
      const passwordInput = document.getElementById("password");
      const signUpBtn = document.getElementById("signup-btn");
      const loginBtn = document.getElementById("login-btn");
      
      if (!emailInput || !passwordInput || !signUpBtn || !loginBtn) return;
      
      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();

      if (!isValidEmail(email)) {
        alert("❌ Invalid email format.");
        emailInput.focus();
        return;
      }
      
      if (!isValidPassword(password)) {
        alert("❌ Password must be at least 8 characters.");
        passwordInput.focus();
        return;
      }

      signUpBtn.disabled = true;
      loginBtn.disabled = true;
      signUpBtn.textContent = "Signing Up...";

      try {
        const response = await fetch("https://visionflow-backend-vdjh.onrender.com/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (data.user && !data.error) {
          localStorage.setItem("visionflowUser", JSON.stringify(data.user));
          loggedInUser = data.user;
          restoreSession();
          emailInput.value = "";
          passwordInput.value = "";
          setTimeout(() => {
            const userInput = document.getElementById("user-input");
            if (userInput) userInput.focus();
          }, 300);
          showDashboard();
        } else {
          alert(data.error || "Registration failed.");
          emailInput.focus();
        }
      } catch (err) {
        alert("❌ Network error: " + err.message);
        emailInput.focus();
      } finally {
        signUpBtn.disabled = false;
        loginBtn.disabled = false;
        signUpBtn.textContent = "Sign Up";
      }
    }

    async function login() {
      const emailInput = document.getElementById("email");
      const passwordInput = document.getElementById("password");
      const signUpBtn = document.getElementById("signup-btn");
      const loginBtn = document.getElementById("login-btn");
      
      if (!emailInput || !passwordInput || !signUpBtn || !loginBtn) return;
      
      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();

      if (!isValidEmail(email)) {
        alert("❌ Invalid email format.");
        emailInput.focus();
        return;
      }
      
      if (!isValidPassword(password)) {
        alert("❌ Password must be at least 8 characters.");
        passwordInput.focus();
        return;
      }

      signUpBtn.disabled = true;
      loginBtn.disabled = true;
      loginBtn.textContent = "Logging In...";

      try {
        const response = await fetch("https://visionflow-backend-vdjh.onrender.com/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (data.user) {
          localStorage.setItem("visionflowUser", JSON.stringify(data.user));
          loggedInUser = data.user;
          restoreSession();
          const chatBox = document.getElementById("chat-box");
          if (chatBox) chatBox.innerHTML = "";
          emailInput.value = "";
          passwordInput.value = "";
          setTimeout(() => {
            const userInput = document.getElementById("user-input");
            if (userInput) userInput.focus();
          }, 300);
          showDashboard();
        } else {
          alert(data.error || "Login failed.");
          passwordInput.focus();
        }
      } catch (err) {
        alert("❌ Network error: " + err.message);
        emailInput.focus();
      } finally {
        signUpBtn.disabled = false;
        loginBtn.disabled = false;
        loginBtn.textContent = "Login";
      }
    }

    function logout() {
      localStorage.removeItem("visionflowUser");
      loggedInUser = null;
      restoreSession();
      const chatBox = document.getElementById("chat-box");
      if (chatBox) chatBox.innerHTML = "";
      showAuth();
      alert("👋 Logged out.");
    }

    // Chat functionality
    async function handleChatSubmit(e) {
      e.preventDefault();
      
      const savedUser = localStorage.getItem("visionflowUser");
      loggedInUser = savedUser ? JSON.parse(savedUser) : null;
      
      if (!loggedInUser || !loggedInUser.email) {
        alert("❌ Please login or sign up first.");
        restoreSession();
        return;
      }

      const userInput = document.getElementById("user-input");
      const toolSelect = document.getElementById("tool-select");
      const chatBox = document.getElementById("chat-box");
      const sendBtn = document.getElementById("send-btn");
      
      if (!userInput || !toolSelect || !chatBox) return;
      
      const message = userInput.value.trim();
      const tool = toolSelect.value;
      
      if (!message) return;

      const fullPrompt = generatePrompt(tool, message);
      chatBox.innerHTML += `<p><strong>You:</strong> ${message}</p>`;
      userInput.value = "";
      
      if (sendBtn) {
        sendBtn.disabled = true;
        sendBtn.textContent = "Sending...";
      }

      try {
        const response = await fetch("https://visionflow-backend-vdjh.onrender.com/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: fullPrompt, tool, email: loggedInUser.email })
        });
        
        const data = await response.json();
        let responseHtml = "";
        
        if (tool === "logo" && data.image) {
          responseHtml = `
            <p><strong>VisionFlow:</strong></p>
            <img id="generated-logo" src="${data.image}" alt="Generated Logo" style="max-width:100%; border-radius:8px;" />
            <br><br>
            <button onclick="saveFavorite('${message.replace(/'/g, "\\'")}', '${data.image}')">💾 Save to Favorites</button>
          `;
        } else if (data.reply) {
          responseHtml = `
            <p><strong>VisionFlow:</strong></p>
            <pre style="white-space: pre-wrap;">${data.reply}</pre>
            <button onclick="saveFavorite('${message.replace(/'/g, "\\'")}', \`${data.reply.replace(/`/g, "\\`")}\`)">💾 Save to Favorites</button>
          `;
        } else {
          responseHtml = `<p><strong>VisionFlow:</strong> Sorry, something went wrong.</p>`;
        }
        
        chatBox.innerHTML += responseHtml;
        chatBox.scrollTop = chatBox.scrollHeight;
      } catch (err) {
        alert("Error talking to AI: " + err.message);
      } finally {
        if (sendBtn) {
          sendBtn.disabled = false;
          sendBtn.textContent = "Send";
        }
      }
    }

    // Favorites functionality
    async function saveFavorite(question, answer) {
      if (!loggedInUser || !loggedInUser.email) {
        alert("Please login to save favorites.");
        return;
      }

      try {
        const response = await fetch("https://visionflow-backend-vdjh.onrender.com/save-favorite", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question, answer, email: loggedInUser.email })
        });
        
        const data = await response.json();
        
        if (data.message) {
          alert("✅ " + data.message);
        } else {
          alert("❌ " + data.error);
        }
      } catch (err) {
        alert("❌ Network error: " + err.message);
      }
    }

    async function viewFavorites() {
      if (!loggedInUser || !loggedInUser.email) {
        alert("Please login to view favorites.");
        return;
      }

      try {
        const response = await fetch("https://visionflow-backend-vdjh.onrender.com/favorites", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email: loggedInUser.email })
        });
        
        const data = await response.json();
        favorites = data.favorites || [];
        const list = document.getElementById("favorites-list");
        
        if (list) {
          list.innerHTML = "";
          favorites.forEach(f => {
            const li = document.createElement("li");
            li.innerHTML = `
              <strong>Q:</strong> ${f.question}<br>
              <strong>A:</strong> ${f.answer}<br>
              <button onclick="deleteFavorite('${f.question.replace(/'/g, "\\'")}')">❌ Delete</button>
              <hr>
            `;
            list.appendChild(li);
          });
        }
      } catch (err) {
        alert("❌ Network error: " + err.message);
      }
    }

    async function deleteFavorite(question) {
      if (!loggedInUser || !loggedInUser.email) {
        alert("Please login to delete favorites.");
        return;
      }

      try {
        const response = await fetch("https://visionflow-backend-vdjh.onrender.com/delete-favorite", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question, email: loggedInUser.email })
        });
        
        const data = await response.json();
        alert(data.message || data.error);
        viewFavorites();
      } catch (err) {
        alert("❌ Network error: " + err.message);
      }
    }

    async function clearFavorites() {
      if (!loggedInUser || !loggedInUser.email) {
        alert("Please login to clear favorites.");
        return;
      }

      if (!confirm("Are you sure you want to clear all favorites?")) return;

      try {
        const response = await fetch("https://visionflow-backend-vdjh.onrender.com/clear-favorites", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email: loggedInUser.email })
        });
        
        const data = await response.json();
        alert(data.message || data.error);
        const list = document.getElementById("favorites-list");
        if (list) list.innerHTML = "";
      } catch (err) {
        alert("❌ Network error: " + err.message);
      }
    }

    // Export functions
    function exportToTXT() {
      if (favorites.length === 0) {
        alert("No favorites to export.");
        return;
      }
      
      const content = favorites.map(f => `Q: ${f.question}\nA: ${f.answer}\n`).join("\n");
      downloadFile("favorites.txt", content);
    }

    function exportToCSV() {
      if (favorites.length === 0) {
        alert("No favorites to export.");
        return;
      }
      
      const csv = "Question,Answer\n" + favorites.map(f => 
        `"${f.question.replace(/"/g, '""')}","${f.answer.replace(/"/g, '""')}"`)
        .join("\n");
      downloadFile("favorites.csv", csv);
    }

    function exportToPDF() {
      if (favorites.length === 0) {
        alert("No favorites to export.");
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let y = 10;
      
      favorites.forEach(fav => {
        const text = `Q: ${fav.question}\nA: ${fav.answer}`;
        const lines = doc.splitTextToSize(text, 180);
        doc.text(lines, 10, y);
        y += lines.length * 10 + 10;
        if (y > 280) { 
          doc.addPage(); 
          y = 10; 
        }
      });
      
      doc.save("favorites.pdf");
    }

    function downloadFile(filename, content) {
      const blob = new Blob([content], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(link.href);
    }

    // Logo download function
    async function downloadLogo(format) {
      const img = document.getElementById("generated-logo");
      if (!img || !img.src) {
        alert("❌ No logo found.");
        return;
      }

      try {
        const response = await fetch(img.src);
        const blob = await response.blob();
        
        if (format === "png") {
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = url;
          link.download = "logo.png";
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        } else {
          const url = URL.createObjectURL(blob);
          const image = new Image();
          image.onload = function() {
            const canvas = document.createElement("canvas");
            canvas.width = image.width;
            canvas.height = image.height;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(image, 0, 0);
            const dataUrl = canvas.toDataURL("image/jpeg", 0.95);
            const link = document.createElement("a");
            link.href = dataUrl;
            link.download = "logo.jpg";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
          };
          image.src = url;
        }
      } catch (err) {
        alert("❌ Failed to download logo: " + err.message);
      }
    }

    // Prompt generation function
    function generatePrompt(tool, input) {
      switch (tool) {
        case "cofounder":
          return `You are my AI cofounder. Help me brainstorm ideas, strategies, and solutions for my startup. My current challenge is: ${input}`;
        case "idea":
          return `You're a startup idea machine. Give 3 creative, profitable startup ideas for: ${input}`;
        case "market":
          return `You're a market research expert. Provide competitor analysis, audience, and trends for: ${input}`;
        case "mvp":
          return `Act as a product manager. Create an MVP launch plan for: ${input}`;
        case "gtm":
          return `Act as a growth hacker. Create a launch strategy and ad copy for: ${input}`;
        case "brand":
          return `Act as a brand strategist. For "${input}", provide name, slogan, colors, fonts, tone.`;
        case "step":
          return `You are a startup mentor. Give me a step-by-step launch guide for: ${input}. Make it scalable for growth, include automation/delegation tips, and break it into phases: validation, MVP, growth, and scaling. Each step should be actionable and specific.`;
        case "pitch":
          return `Startup strategist. Generate a 10-slide pitch deck for: ${input}`;
        case "plan":
          return `You're a business analyst. Write a full business plan for: ${input}, including:\n1. Executive Summary\n2. Product/Service Description\n3. Target Market\n4. Market Analysis\n5. Competitive Advantage\n6. Operations Plan\n7. SWOT Analysis\n8. Financial Forecast\n9. Marketing Strategy\n10. Conclusion\n\nThen, provide a detailed 30-day action plan for launching and growing this business, with specific tasks and milestones for each day.`;
        case "adcopy":
          return `You're a conversion-focused ad copywriter. Write 3 winning ad variants for: "${input}". Each ad should include:\n- A catchy Headline\n- Primary Text\n- A strong Call to Action`;
        case "logo":
          return `Generate a clean, modern logo for the brand: "${input}". The logo should be abstract and reflect the brand visually without including any text or letters. Focus on symbolism and brand personality.`;
        case "resume":
          return `Professional resume writer. Write a full ATS-optimized resume for: ${input}`;
        case "winning":
          return `You are a product research expert. Find 5 winning or trending products that are real shortcuts, solve a big problem, and have a 'wow' factor for: ${input}. For each, explain why it's a shortcut, what problem it solves, and what makes it a wow product (e.g., viral, unique, or untapped market).`;
        case "legal":
          return `You're a legal document generator. Write full legal documents including Terms of Service, Privacy Policy, and Cookie Notice for: ${input}. The company should be compliant with global privacy laws (e.g., GDPR, CCPA). Keep the output clear and legally sound.`;
        case "name":
          return `You are a creative naming assistant. Suggest 10 unique, brandable product names for: ${input}. Make sure the names are short, catchy, and sound like startup brands.`;
        case "email":
          return `You are an expert cold email copywriter. Write a personalized, persuasive email for: ${input}`;
        case "landing":
          return `You are a conversion copywriting expert. Write a full landing page copy (headline, subheadline, bullet points, call-to-action) for: ${input}`;
        case "digitalproduct":
          return `You're a digital product strategist. Suggest 5 profitable digital products for this niche or idea: ${input}. For each product, include what it is, target audience, how to sell it, and why it would work.`;
        case "valueprop":
          return `You're a SaaS marketing expert. Generate a powerful, one-sentence value proposition for: ${input}. Use clear, outcome-driven language.`;
        case "validate":
          return `You're a startup advisor. Validate this startup idea by checking if the problem is strong, and if the solution matches well. Give feedback and improvement tips. Idea: ${input}`;
        case "growth":
          return `You're a growth hacker. Suggest 3 creative, low-cost growth strategies for: ${input}. Focus on viral marketing, community building, and user acquisition.`;
        case "funding":
          return `You're an investor relations expert. Write a compelling email to angel investors for: ${input}. Highlight the problem, solution, market opportunity, and why they should invest.`;
        case "community":
          return `You're a community builder. Suggest 5 creative ways to build an engaged community around: ${input}. Focus on online platforms, content strategies, and engagement tactics.`;
        case "scale":
          return `You're a startup growth advisor. Create a scaling roadmap for: ${input}. Include: - Key growth milestones - Hiring suggestions - Platform expansion - Budget considerations - Revenue targets`;
        case "social":
          return `You're a social media marketing expert. Create a comprehensive 30-day social media marketing strategy for: ${input}. For each day, specify the platform, post type, content idea, and engagement tactic. Include:
          - Platform-specific tips (Instagram, TikTok, LinkedIn)
          - Post types (reels, carousels, tweets)
          - Hashtag recommendations
          - Posting frequency and engagement hacks`;
        default:
          return input;
      }
    }

    // Event handlers
    function attachEventHandlers() {
      const signupBtn = document.getElementById("signup-btn");
      const loginBtn = document.getElementById("login-btn");
      const logoutButton = document.getElementById("logout-button");
      const chatForm = document.getElementById("chat-form");
      const viewFavoritesBtn = document.getElementById("view-favorites-btn");
      const clearFavoritesBtn = document.getElementById("clear-favorites-btn");
      const exportTxtBtn = document.getElementById("export-txt-btn");
      const exportCsvBtn = document.getElementById("export-csv-btn");
      const exportPdfBtn = document.getElementById("export-pdf-btn");
      const toggleTheme = document.getElementById("toggle-theme");
      const toolSelect = document.getElementById("tool-select");

      if (signupBtn) signupBtn.onclick = register;
      if (loginBtn) loginBtn.onclick = login;
      if (logoutButton) logoutButton.onclick = logout;
      if (chatForm) chatForm.onsubmit = handleChatSubmit;
      if (viewFavoritesBtn) viewFavoritesBtn.onclick = viewFavorites;
      if (clearFavoritesBtn) clearFavoritesBtn.onclick = clearFavorites;
      if (exportTxtBtn) exportTxtBtn.onclick = exportToTXT;
      if (exportCsvBtn) exportCsvBtn.onclick = exportToCSV;
      if (exportPdfBtn) exportPdfBtn.onclick = exportToPDF;
      if (toolSelect) toolSelect.onchange = updateToolUI;
      
      if (toggleTheme) {
        toggleTheme.onclick = () => {
          if (document.body.classList.contains("light-mode")) {
            document.body.classList.remove("light-mode");
            document.body.classList.add("dark-mode");
          } else {
            document.body.classList.remove("dark-mode");
            document.body.classList.add("light-mode");
          }
          updateThemeButton();
        };
      }
    }

    // Initialize app
    window.addEventListener("DOMContentLoaded", () => {
      restoreSession();
      document.body.classList.add("dark-mode");
      updateThemeButton();
      attachEventHandlers();
      updateToolUI();

      // Accessibility improvements
      const emailInput = document.getElementById('email');
      const passwordInput = document.getElementById('password');
      
      if (emailInput) {
        emailInput.setAttribute('tabindex', '1');
        emailInput.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' && passwordInput) {
            passwordInput.focus();
          }
        });
      }
      
      if (passwordInput) {
        passwordInput.setAttribute('tabindex', '2');
        passwordInput.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') {
            login();
          }
        });
      }

      // Loading state feedback
      const signupBtn = document.getElementById('signup-btn');
      const loginBtn = document.getElementById('login-btn');
      
      if (signupBtn) {
        signupBtn.addEventListener('click', () => {
          signupBtn.textContent = 'Signing Up...';
          setTimeout(() => { 
            if (signupBtn.textContent === 'Signing Up...') {
              signupBtn.textContent = 'Sign Up'; 
            }
          }, 5000);
        });
      }
      
      if (loginBtn) {
        loginBtn.addEventListener('click', () => {
          loginBtn.textContent = 'Logging In...';
          setTimeout(() => { 
            if (loginBtn.textContent === 'Logging In...') {
              loginBtn.textContent = 'Login'; 
            }
          }, 5000);
        });
      }

      // Prevent double submit
      const chatForm = document.getElementById('chat-form');
      if (chatForm) {
        chatForm.addEventListener('submit', function(e) {
          const sendBtn = document.getElementById('send-btn');
          if (sendBtn && !sendBtn.disabled) {
            sendBtn.disabled = true;
            setTimeout(() => { 
              sendBtn.disabled = false; 
            }, 3000);
          }
        });
      }
    });

    // Make functions globally available
    window.saveFavorite = saveFavorite;
    window.deleteFavorite = deleteFavorite;
    window.downloadLogo = downloadLogo;
  </script>
</body>
</html>
